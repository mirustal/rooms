{"ast":null,"code":"import { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport vkBridge from \"@vkontakte/vk-bridge\";\nimport { noop } from \"@vkontakte/vkjs\";\nimport { resolveAppearance } from \"../helpers/appearance\";\nimport { useDOM } from \"../lib/dom\";\nimport { matchMediaListAddListener, matchMediaListRemoveListener } from \"../lib/matchMedia\";\nfunction autoDetectAppearanceByBridge(setAppearance, onDetectAppearanceByBridge) {\n  function updateAppearance(data) {\n    var initialAppearance = resolveAppearance(data);\n    if (initialAppearance) {\n      onDetectAppearanceByBridge();\n      setAppearance(initialAppearance);\n    }\n  }\n  function bridgeListener(e) {\n    var _e_detail = e.detail,\n      type = _e_detail.type,\n      data = _e_detail.data;\n    if (type !== \"VKWebAppUpdateConfig\") {\n      return;\n    }\n    updateAppearance(data);\n  }\n  vkBridge.subscribe(bridgeListener);\n  vkBridge.send(\"VKWebAppGetConfig\").then(updateAppearance).catch(console.error);\n  return function () {\n    return vkBridge.unsubscribe(bridgeListener);\n  };\n}\nfunction autoDetectAppearance(window, setAppearance) {\n  var mediaQuery = window && window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\");\n  if (mediaQuery === undefined) {\n    return noop;\n  }\n  var check = function (event) {\n    // eslint-disable-next-line no-restricted-properties\n    setAppearance(event.matches ? \"dark\" : \"light\");\n  };\n  check(mediaQuery);\n  matchMediaListAddListener(mediaQuery, check);\n  return function () {\n    return matchMediaListRemoveListener(mediaQuery, check);\n  };\n}\n/**\n * TODO [>=6]: удалить хук (#5049)\n * @deprecated v5.8.0\n */\nexport var useAutoDetectAppearance = function (appearanceProp, onDetectAppearanceByBridge) {\n  var window = useDOM().window;\n  var onceDetectAppearanceByBridge = React.useRef(function () {\n    onDetectAppearanceByBridge && onDetectAppearanceByBridge();\n    onceDetectAppearanceByBridge.current = noop;\n  });\n  var _React_useState = _sliced_to_array(React.useState(function () {\n      if (appearanceProp) {\n        return appearanceProp;\n      }\n      var mediaQuery = window && window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\");\n      // eslint-disable-next-line no-restricted-properties\n      return (mediaQuery === null || mediaQuery === void 0 ? void 0 : mediaQuery.matches) ? \"dark\" : \"light\";\n    }), 2),\n    appearance = _React_useState[0],\n    setAppearance = _React_useState[1];\n  React.useEffect(function () {\n    if (appearanceProp) {\n      setAppearance(appearanceProp);\n      return noop;\n    }\n    if (vkBridge.isEmbedded()) {\n      return autoDetectAppearanceByBridge(setAppearance, onceDetectAppearanceByBridge.current);\n    }\n    return autoDetectAppearance(window, setAppearance);\n  }, [window, appearanceProp]);\n  return appearance;\n};","map":{"version":3,"names":["React","vkBridge","noop","resolveAppearance","useDOM","matchMediaListAddListener","matchMediaListRemoveListener","autoDetectAppearanceByBridge","setAppearance","onDetectAppearanceByBridge","updateAppearance","data","initialAppearance","bridgeListener","e","_e_detail","detail","type","subscribe","send","then","catch","console","error","unsubscribe","autoDetectAppearance","window","mediaQuery","matchMedia","undefined","check","event","matches","useAutoDetectAppearance","appearanceProp","onceDetectAppearanceByBridge","useRef","current","_React_useState","_sliced_to_array","useState","appearance","useEffect","isEmbedded"],"sources":["../../src/hooks/useAutoDetectAppearance.tsx"],"sourcesContent":["import * as React from 'react';\nimport vkBridge, {\n  AnyReceiveMethodName,\n  AppearanceType,\n  VKBridgeEvent,\n} from '@vkontakte/vk-bridge';\nimport { noop } from '@vkontakte/vkjs';\nimport { resolveAppearance, VKBridgeConfigData } from '../helpers/appearance';\nimport { useDOM } from '../lib/dom';\nimport { matchMediaListAddListener, matchMediaListRemoveListener } from '../lib/matchMedia';\n\nfunction autoDetectAppearanceByBridge(\n  setAppearance: (value: AppearanceType) => void,\n  onDetectAppearanceByBridge: () => void,\n) {\n  function updateAppearance(data: VKBridgeConfigData) {\n    const initialAppearance = resolveAppearance(data);\n\n    if (initialAppearance) {\n      onDetectAppearanceByBridge();\n      setAppearance(initialAppearance);\n    }\n  }\n\n  function bridgeListener(e: VKBridgeEvent<AnyReceiveMethodName>) {\n    const { type, data } = e.detail;\n\n    if (type !== 'VKWebAppUpdateConfig') {\n      return;\n    }\n\n    updateAppearance(data as VKBridgeConfigData);\n  }\n\n  vkBridge.subscribe(bridgeListener);\n  vkBridge.send('VKWebAppGetConfig').then(updateAppearance).catch(console.error);\n\n  return () => vkBridge.unsubscribe(bridgeListener);\n}\n\nfunction autoDetectAppearance(\n  window: Window | undefined,\n  setAppearance: (value: AppearanceType) => void,\n): () => void {\n  const mediaQuery =\n    window && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');\n\n  if (mediaQuery === undefined) {\n    return noop;\n  }\n\n  const check = (event: MediaQueryList | MediaQueryListEvent) => {\n    // eslint-disable-next-line no-restricted-properties\n    setAppearance(event.matches ? 'dark' : 'light');\n  };\n\n  check(mediaQuery);\n  matchMediaListAddListener(mediaQuery, check);\n\n  return () => matchMediaListRemoveListener(mediaQuery, check);\n}\n\n/**\n * TODO [>=6]: удалить хук (#5049)\n * @deprecated v5.8.0\n */\nexport const useAutoDetectAppearance = (\n  appearanceProp?: AppearanceType,\n  onDetectAppearanceByBridge?: () => void,\n): AppearanceType => {\n  const { window } = useDOM();\n  const onceDetectAppearanceByBridge = React.useRef(() => {\n    onDetectAppearanceByBridge && onDetectAppearanceByBridge();\n    onceDetectAppearanceByBridge.current = noop;\n  });\n\n  const [appearance, setAppearance] = React.useState<AppearanceType>(() => {\n    if (appearanceProp) {\n      return appearanceProp;\n    }\n\n    const mediaQuery =\n      window && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');\n\n    // eslint-disable-next-line no-restricted-properties\n    return mediaQuery?.matches ? 'dark' : 'light';\n  });\n\n  React.useEffect(() => {\n    if (appearanceProp) {\n      setAppearance(appearanceProp);\n      return noop;\n    }\n\n    if (vkBridge.isEmbedded()) {\n      return autoDetectAppearanceByBridge(setAppearance, onceDetectAppearanceByBridge.current);\n    }\n\n    return autoDetectAppearance(window, setAppearance);\n  }, [window, appearanceProp]);\n\n  return appearance;\n};\n"],"mappings":";AAAA,YAAYA,KAAA,MAAW;AACvB,OAAOC,QAAA,MAIA;AACP,SAASC,IAAI,QAAQ;AACrB,SAASC,iBAAiB,QAA4B;AACtD,SAASC,MAAM,QAAQ;AACvB,SAASC,yBAAyB,EAAEC,4BAA4B,QAAQ;AAExE,SAASC,6BACPC,aAA8C,EAC9CC,0BAAsC;EAEtC,SAASC,iBAAiBC,IAAwB;IAChD,IAAMC,iBAAA,GAAoBT,iBAAA,CAAkBQ,IAAA;IAE5C,IAAIC,iBAAA,EAAmB;MACrBH,0BAAA;MACAD,aAAA,CAAcI,iBAAA;IAChB;EACF;EAEA,SAASC,eAAeC,CAAsC;IAC5D,IAAuBC,SAAA,GAAAD,CAAA,CAAEE,MAAM;MAAvBC,IAAA,GAAeF,SAAA,CAAfE,IAAA;MAAMN,IAAA,GAASI,SAAA,CAATJ,IAAA;IAEd,IAAIM,IAAA,KAAS,wBAAwB;MACnC;IACF;IAEAP,gBAAA,CAAiBC,IAAA;EACnB;EAEAV,QAAA,CAASiB,SAAS,CAACL,cAAA;EACnBZ,QAAA,CAASkB,IAAI,CAAC,qBAAqBC,IAAI,CAACV,gBAAA,EAAkBW,KAAK,CAACC,OAAA,CAAQC,KAAK;EAE7E,OAAO;WAAMtB,QAAA,CAASuB,WAAW,CAACX,cAAA;;AACpC;AAEA,SAASY,qBACPC,MAA0B,EAC1BlB,aAA8C;EAE9C,IAAMmB,UAAA,GACJD,MAAA,IAAUA,MAAA,CAAOE,UAAU,IAAIF,MAAA,CAAOE,UAAU,CAAC;EAEnD,IAAID,UAAA,KAAeE,SAAA,EAAW;IAC5B,OAAO3B,IAAA;EACT;EAEA,IAAM4B,KAAA,GAAQ,SAAAA,CAACC,KAAA;IACb;IACAvB,aAAA,CAAcuB,KAAA,CAAMC,OAAO,GAAG,SAAS;EACzC;EAEAF,KAAA,CAAMH,UAAA;EACNtB,yBAAA,CAA0BsB,UAAA,EAAYG,KAAA;EAEtC,OAAO;WAAMxB,4BAAA,CAA6BqB,UAAA,EAAYG,KAAA;;AACxD;AAEA;;;;AAIA,OAAO,IAAMG,uBAAA,GAA0B,SAAAA,CACrCC,cAAA,EACAzB,0BAAA;EAEA,IAAMiB,MAAE,GAAWtB,MAAA,GAAXsB,MAAA;EACR,IAAMS,4BAAA,GAA+BnC,KAAA,CAAMoC,MAAM,CAAC;IAChD3B,0BAAA,IAA8BA,0BAAA;IAC9B0B,4BAAA,CAA6BE,OAAO,GAAGnC,IAAA;EACzC;EAEA,IAAoCoC,eAAA,GAAAC,gBAAA,CAAAvC,KAAA,CAAMwC,QAAQ,CAAiB;MACjE,IAAIN,cAAA,EAAgB;QAClB,OAAOA,cAAA;MACT;MAEA,IAAMP,UAAA,GACJD,MAAA,IAAUA,MAAA,CAAOE,UAAU,IAAIF,MAAA,CAAOE,UAAU,CAAC;MAEnD;MACA,OAAO,CAAAD,UAAA,aAAAA,UAAA,uBAAAA,UAAA,CAAYK,OAAO,IAAG,SAAS;IACxC;IAVOS,UAAA,GAA6BH,eAAA;IAAjB9B,aAAA,GAAiB8B,eAAA;EAYpCtC,KAAA,CAAM0C,SAAS,CAAC;IACd,IAAIR,cAAA,EAAgB;MAClB1B,aAAA,CAAc0B,cAAA;MACd,OAAOhC,IAAA;IACT;IAEA,IAAID,QAAA,CAAS0C,UAAU,IAAI;MACzB,OAAOpC,4BAAA,CAA6BC,aAAA,EAAe2B,4BAAA,CAA6BE,OAAO;IACzF;IAEA,OAAOZ,oBAAA,CAAqBC,MAAA,EAAQlB,aAAA;EACtC,GAAG,CAACkB,MAAA,EAAQQ,cAAA,CAAe;EAE3B,OAAOO,UAAA;AACT"},"metadata":{},"sourceType":"module"}