{"ast":null,"code":"import { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport vkBridge from \"@vkontakte/vk-bridge\";\nimport { useIsomorphicLayoutEffect } from \"../lib/useIsomorphicLayoutEffect\";\nvar initialState = {\n  type: \"\",\n  viewportWidth: 0,\n  viewportHeight: 0\n};\nfunction resolveAdaptivity(data) {\n  var adaptivity = data.adaptivity,\n    viewport_width = data.viewport_width,\n    viewport_height = data.viewport_height;\n  var bridgeAdaptivity = {\n    type: \"\",\n    viewportWidth: isFinite(viewport_width) ? Number(viewport_width) : 0,\n    viewportHeight: isFinite(viewport_height) ? Number(viewport_height) : 0\n  };\n  switch (adaptivity) {\n    case \"force_mobile\":\n    case \"force_mobile_compact\":\n    case \"adaptive\":\n      bridgeAdaptivity.type = adaptivity;\n  }\n  return bridgeAdaptivity;\n}\n/**\n * TODO [>=6]: удалить хук (#5049)\n * @deprecated v5.8.0\n */\nexport function useBridgeAdaptivity() {\n  var disable = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : false;\n  var _React_useState = _sliced_to_array(React.useState(initialState), 2),\n    bridgeAdaptivity = _React_useState[0],\n    setBridgeAdaptivity = _React_useState[1];\n  useIsomorphicLayoutEffect(function () {\n    if (disable) {\n      return;\n    }\n    var updateAdaptivity = function (data) {\n      if (!(\"adaptivity\" in data) || !(\"viewport_width\" in data) || !(\"viewport_height\" in data)) {\n        return;\n      }\n      var newAdaptivity = resolveAdaptivity(data);\n      if (newAdaptivity) {\n        setBridgeAdaptivity(newAdaptivity);\n      }\n    };\n    var handleBridgeEvent = function (event) {\n      var _event_detail = event.detail,\n        type = _event_detail.type,\n        data = _event_detail.data;\n      if (type !== \"VKWebAppUpdateConfig\") {\n        return;\n      }\n      updateAdaptivity(data);\n    };\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send(\"VKWebAppGetConfig\").then(updateAdaptivity).catch(console.error);\n    return function () {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n  return bridgeAdaptivity;\n}","map":{"version":3,"names":["React","vkBridge","useIsomorphicLayoutEffect","initialState","type","viewportWidth","viewportHeight","resolveAdaptivity","data","adaptivity","viewport_width","viewport_height","bridgeAdaptivity","isFinite","Number","useBridgeAdaptivity","disable","arguments","length","_React_useState","_sliced_to_array","useState","setBridgeAdaptivity","updateAdaptivity","newAdaptivity","handleBridgeEvent","event","_event_detail","detail","subscribe","send","then","catch","console","error","unsubscribe"],"sources":["../../src/hooks/useBridgeAdaptivity.ts"],"sourcesContent":["import * as React from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport { useIsomorphicLayoutEffect } from '../lib/useIsomorphicLayoutEffect';\n\nexport interface BridgeAdaptivity {\n  type: '' | 'force_mobile' | 'force_mobile_compact' | 'adaptive';\n  viewportWidth: number;\n  viewportHeight: number;\n}\n\ninterface BridgeEvent {\n  detail: {\n    type: string;\n    data: {\n      [index: string]: any;\n    };\n  };\n}\n\nlet initialState: BridgeAdaptivity = {\n  type: '',\n  viewportWidth: 0,\n  viewportHeight: 0,\n};\n\nfunction resolveAdaptivity(data: any): BridgeAdaptivity | null {\n  const { adaptivity, viewport_width, viewport_height } = data;\n\n  const bridgeAdaptivity: BridgeAdaptivity = {\n    type: '',\n    viewportWidth: isFinite(viewport_width) ? Number(viewport_width) : 0,\n    viewportHeight: isFinite(viewport_height) ? Number(viewport_height) : 0,\n  };\n\n  switch (adaptivity) {\n    case 'force_mobile':\n    case 'force_mobile_compact':\n    case 'adaptive':\n      bridgeAdaptivity.type = adaptivity;\n  }\n\n  return bridgeAdaptivity;\n}\n\n/**\n * TODO [>=6]: удалить хук (#5049)\n * @deprecated v5.8.0\n */\nexport function useBridgeAdaptivity(disable = false): BridgeAdaptivity {\n  const [bridgeAdaptivity, setBridgeAdaptivity] = React.useState<BridgeAdaptivity>(initialState);\n\n  useIsomorphicLayoutEffect(() => {\n    if (disable) {\n      return;\n    }\n\n    const updateAdaptivity = (data: any) => {\n      if (!('adaptivity' in data) || !('viewport_width' in data) || !('viewport_height' in data)) {\n        return;\n      }\n\n      const newAdaptivity = resolveAdaptivity(data);\n\n      if (newAdaptivity) {\n        setBridgeAdaptivity(newAdaptivity);\n      }\n    };\n\n    const handleBridgeEvent = (event: BridgeEvent) => {\n      const { type, data } = event.detail;\n\n      if (type !== 'VKWebAppUpdateConfig') {\n        return;\n      }\n\n      updateAdaptivity(data);\n    };\n\n    vkBridge.subscribe(handleBridgeEvent);\n    vkBridge.send('VKWebAppGetConfig').then(updateAdaptivity).catch(console.error);\n\n    return () => {\n      vkBridge.unsubscribe(handleBridgeEvent);\n    };\n  }, []);\n\n  return bridgeAdaptivity;\n}\n"],"mappings":";AAAA,YAAYA,KAAA,MAAW;AACvB,OAAOC,QAAA,MAAc;AACrB,SAASC,yBAAyB,QAAQ;AAiB1C,IAAIC,YAAA,GAAiC;EACnCC,IAAA,EAAM;EACNC,aAAA,EAAe;EACfC,cAAA,EAAgB;AAClB;AAEA,SAASC,kBAAkBC,IAAS;EAClC,IAAQC,UAAA,GAAgDD,IAAA,CAAhDC,UAAA;IAAYC,cAAA,GAAoCF,IAAA,CAApCE,cAAA;IAAgBC,eAAA,GAAoBH,IAAA,CAApBG,eAAA;EAEpC,IAAMC,gBAAA,GAAqC;IACzCR,IAAA,EAAM;IACNC,aAAA,EAAeQ,QAAA,CAASH,cAAA,IAAkBI,MAAA,CAAOJ,cAAA,IAAkB;IACnEJ,cAAA,EAAgBO,QAAA,CAASF,eAAA,IAAmBG,MAAA,CAAOH,eAAA,IAAmB;EACxE;EAEA,QAAQF,UAAA;IACN,KAAK;IACL,KAAK;IACL,KAAK;MACHG,gBAAA,CAAiBR,IAAI,GAAGK,UAAA;EAC5B;EAEA,OAAOG,gBAAA;AACT;AAEA;;;;AAIA,OAAO,SAASG,oBAAA;MAAoBC,OAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,iBAAAA,SAAA,MAAU;EAC5C,IAAgDE,eAAA,GAAAC,gBAAA,CAAApB,KAAA,CAAMqB,QAAQ,CAAmBlB,YAAA;IAA1ES,gBAAA,GAAyCO,eAAA;IAAvBG,mBAAA,GAAuBH,eAAA;EAEhDjB,yBAAA,CAA0B;IACxB,IAAIc,OAAA,EAAS;MACX;IACF;IAEA,IAAMO,gBAAA,GAAmB,SAAAA,CAACf,IAAA;MACxB,IAAI,EAAE,gBAAgBA,IAAG,KAAM,EAAE,oBAAoBA,IAAG,KAAM,EAAE,qBAAqBA,IAAG,GAAI;QAC1F;MACF;MAEA,IAAMgB,aAAA,GAAgBjB,iBAAA,CAAkBC,IAAA;MAExC,IAAIgB,aAAA,EAAe;QACjBF,mBAAA,CAAoBE,aAAA;MACtB;IACF;IAEA,IAAMC,iBAAA,GAAoB,SAAAA,CAACC,KAAA;MACzB,IAAuBC,aAAA,GAAAD,KAAA,CAAME,MAAM;QAA3BxB,IAAA,GAAeuB,aAAA,CAAfvB,IAAA;QAAMI,IAAA,GAASmB,aAAA,CAATnB,IAAA;MAEd,IAAIJ,IAAA,KAAS,wBAAwB;QACnC;MACF;MAEAmB,gBAAA,CAAiBf,IAAA;IACnB;IAEAP,QAAA,CAAS4B,SAAS,CAACJ,iBAAA;IACnBxB,QAAA,CAAS6B,IAAI,CAAC,qBAAqBC,IAAI,CAACR,gBAAA,EAAkBS,KAAK,CAACC,OAAA,CAAQC,KAAK;IAE7E,OAAO;MACLjC,QAAA,CAASkC,WAAW,CAACV,iBAAA;IACvB;EACF,GAAG,EAAE;EAEL,OAAOb,gBAAA;AACT"},"metadata":{},"sourceType":"module"}