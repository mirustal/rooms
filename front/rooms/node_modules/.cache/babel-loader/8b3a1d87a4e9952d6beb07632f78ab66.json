{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from \"../../lib/accessibility\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { AppRootContext } from \"../AppRoot/AppRootContext\";\nvar FOCUSABLE_ELEMENTS = FOCUSABLE_ELEMENTS_LIST.join();\n/**\n * @see https://vkcom.github.io/VKUI/#/FocusTrap\n */\nexport var FocusTrap = function (_param) {\n  var _param_Component = _param.Component,\n    Component = _param_Component === void 0 ? \"div\" : _param_Component,\n    onClose = _param.onClose,\n    _param_restoreFocus = _param.restoreFocus,\n    restoreFocus = _param_restoreFocus === void 0 ? true : _param_restoreFocus,\n    _param_timeout = _param.timeout,\n    timeout = _param_timeout === void 0 ? 0 : _param_timeout,\n    getRootRef = _param.getRootRef,\n    children = _param.children,\n    restProps = _object_without_properties(_param, [\"Component\", \"onClose\", \"restoreFocus\", \"timeout\", \"getRootRef\", \"children\"]);\n  var ref = useExternRef(getRootRef);\n  var _useDOM = useDOM(),\n    document = _useDOM.document,\n    window = _useDOM.window;\n  var _React_useState = _sliced_to_array(React.useState(null), 2),\n    focusableNodes = _React_useState[0],\n    setFocusableNodes = _React_useState[1];\n  var _React_useState1 = _sliced_to_array(React.useState(null), 2),\n    restoreFocusTo = _React_useState1[0],\n    setRestoreFocusTo = _React_useState1[1];\n  // HANDLE TRAP MOUNT\n  var keyboardInput = React.useContext(AppRootContext).keyboardInput;\n  var focusOnTrapMount = useTimeout(function () {\n    var _ref_current;\n    if (keyboardInput && !((_ref_current = ref.current) === null || _ref_current === void 0 ? void 0 : _ref_current.contains(document.activeElement)) && (focusableNodes === null || focusableNodes === void 0 ? void 0 : focusableNodes.length)) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    focusOnTrapMount.set();\n  }, []);\n  // HANDLE FOCUSABLE NODES\n  useIsomorphicLayoutEffect(function () {\n    if (!ref.current) {\n      return;\n    }\n    var nodes = [];\n    Array.prototype.forEach.call(\n    // eslint-disable-next-line no-restricted-properties\n    ref.current.querySelectorAll(FOCUSABLE_ELEMENTS), function (focusableEl) {\n      var _window_getComputedStyle = window.getComputedStyle(focusableEl),\n        display = _window_getComputedStyle.display,\n        visibility = _window_getComputedStyle.visibility;\n      if (display !== \"none\" && visibility !== \"hidden\") {\n        nodes.push(focusableEl);\n      }\n    });\n    if (nodes.length === 0) {\n      // Чтобы фокус был хотя бы на родителе\n      nodes.push(ref.current);\n    }\n    setFocusableNodes(nodes);\n  }, [children]);\n  // HANDLE TRAP UNMOUNT\n  var focusOnTrapUnmount = useTimeout(function () {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    if (restoreFocus && document.activeElement) {\n      setRestoreFocusTo(document.activeElement);\n      return function () {\n        focusOnTrapUnmount.set();\n      };\n    }\n    return;\n  }, [restoreFocus]);\n  var onDocumentKeydown = function (e) {\n    if (pressedKey(e) === Keys.TAB && (focusableNodes === null || focusableNodes === void 0 ? void 0 : focusableNodes.length)) {\n      var lastIdx = focusableNodes.length - 1;\n      var targetIdx = focusableNodes.findIndex(function (node) {\n        return node === e.target;\n      });\n      var shouldFocusFirstNode = targetIdx === -1 || targetIdx === lastIdx && !e.shiftKey;\n      if (shouldFocusFirstNode || targetIdx === 0 && e.shiftKey) {\n        e.preventDefault();\n        var node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n        if (node !== document.activeElement) {\n          node.focus();\n        }\n        return false;\n      }\n    }\n    if (onClose && pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n    return true;\n  };\n  useGlobalEventListener(document, \"keydown\", onDocumentKeydown, {\n    capture: true\n  });\n  return /*#__PURE__*/React.createElement(Component, _object_spread({\n    tabIndex: -1,\n    ref: ref\n  }, restProps), children);\n};","map":{"version":3,"names":["React","useExternRef","useGlobalEventListener","useTimeout","FOCUSABLE_ELEMENTS_LIST","Keys","pressedKey","useDOM","useIsomorphicLayoutEffect","AppRootContext","FOCUSABLE_ELEMENTS","join","FocusTrap","_param","Component","_param_Component","onClose","_param_restoreFocus","restoreFocus","_param_timeout","timeout","getRootRef","children","restProps","_object_without_properties","ref","_useDOM","document","window","_React_useState","_sliced_to_array","useState","focusableNodes","setFocusableNodes","_React_useState1","restoreFocusTo","setRestoreFocusTo","keyboardInput","useContext","focusOnTrapMount","_ref_current","current","contains","activeElement","length","focus","set","nodes","Array","prototype","forEach","call","querySelectorAll","focusableEl","_window_getComputedStyle","getComputedStyle","display","visibility","push","focusOnTrapUnmount","onDocumentKeydown","e","TAB","lastIdx","targetIdx","findIndex","node","target","shouldFocusFirstNode","shiftKey","preventDefault","ESCAPE","capture","createElement","_object_spread","tabIndex"],"sources":["../../../src/components/FocusTrap/FocusTrap.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from '../../lib/accessibility';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HasComponent, HasRootRef } from '../../types';\nimport { AppRootContext } from '../AppRoot/AppRootContext';\n\nconst FOCUSABLE_ELEMENTS: string = FOCUSABLE_ELEMENTS_LIST.join();\nexport interface FocusTrapProps<T extends HTMLElement = HTMLElement>\n  extends React.AllHTMLAttributes<T>,\n    HasRootRef<T>,\n    HasComponent {\n  restoreFocus?: boolean;\n  timeout?: number;\n  onClose?(): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/FocusTrap\n */\nexport const FocusTrap = <T extends HTMLElement = HTMLElement>({\n  Component = 'div',\n  onClose,\n  restoreFocus = true,\n  timeout = 0,\n  getRootRef,\n  children,\n  ...restProps\n}: FocusTrapProps<T>) => {\n  const ref = useExternRef<T>(getRootRef);\n\n  const { document, window } = useDOM();\n\n  const [focusableNodes, setFocusableNodes] = React.useState<HTMLElement[] | null>(null);\n  const [restoreFocusTo, setRestoreFocusTo] = React.useState<HTMLElement | null>(null);\n\n  // HANDLE TRAP MOUNT\n\n  const { keyboardInput } = React.useContext(AppRootContext);\n  const focusOnTrapMount = useTimeout(() => {\n    if (\n      keyboardInput &&\n      !ref.current?.contains(document!.activeElement) &&\n      focusableNodes?.length\n    ) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    focusOnTrapMount.set();\n  }, []);\n\n  // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const nodes: HTMLElement[] = [];\n    Array.prototype.forEach.call(\n      // eslint-disable-next-line no-restricted-properties\n      ref.current.querySelectorAll(FOCUSABLE_ELEMENTS),\n      (focusableEl: Element) => {\n        const { display, visibility } = window!.getComputedStyle(focusableEl);\n\n        if (display !== 'none' && visibility !== 'hidden') {\n          nodes.push(focusableEl as HTMLElement);\n        }\n      },\n    );\n\n    if (nodes.length === 0) {\n      // Чтобы фокус был хотя бы на родителе\n      nodes.push(ref.current);\n    }\n\n    setFocusableNodes(nodes);\n  }, [children]);\n\n  // HANDLE TRAP UNMOUNT\n\n  const focusOnTrapUnmount = useTimeout(() => {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    if (restoreFocus && document!.activeElement) {\n      setRestoreFocusTo(document!.activeElement as HTMLElement);\n\n      return () => {\n        focusOnTrapUnmount.set();\n      };\n    }\n\n    return;\n  }, [restoreFocus]);\n\n  const onDocumentKeydown = (e: KeyboardEvent) => {\n    if (pressedKey(e) === Keys.TAB && focusableNodes?.length) {\n      const lastIdx = focusableNodes.length - 1;\n      const targetIdx = focusableNodes.findIndex((node) => node === e.target);\n\n      const shouldFocusFirstNode = targetIdx === -1 || (targetIdx === lastIdx && !e.shiftKey);\n\n      if (shouldFocusFirstNode || (targetIdx === 0 && e.shiftKey)) {\n        e.preventDefault();\n\n        const node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n\n        if (node !== document!.activeElement) {\n          node.focus();\n        }\n\n        return false;\n      }\n    }\n\n    if (onClose && pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n\n    return true;\n  };\n  useGlobalEventListener(document, 'keydown', onDocumentKeydown, {\n    capture: true,\n  });\n\n  return (\n    <Component tabIndex={-1} ref={ref} {...restProps}>\n      {children}\n    </Component>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}