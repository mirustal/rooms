{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { classNames } from \"@vkontakte/vkjs\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useDOM } from \"../../lib/dom\";\nimport { getNavId } from \"../../lib/getNavId\";\nimport { Platform } from \"../../lib/platform\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { useConfigProvider } from \"../ConfigProvider/ConfigProviderContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { NavTransitionDirectionProvider } from \"../NavTransitionDirectionContext/NavTransitionDirectionContext\";\nimport { RootComponent } from \"../RootComponent/RootComponent\";\nimport { SplitColContext } from \"../SplitCol/SplitColContext\";\nvar warn = warnOnce(\"Root\");\n/**\n * @see https://vkcom.github.io/VKUI/#/Root\n */\nexport var Root = function (_param) {\n  var children = _param.children,\n    _activeView = _param.activeView,\n    onTransition = _param.onTransition,\n    nav = _param.nav,\n    restProps = _object_without_properties(_param, [\"children\", \"activeView\", \"onTransition\", \"nav\"]);\n  var scroll = React.useContext(ScrollContext);\n  var platform = usePlatform();\n  var document = useDOM().document;\n  var scrolls = React.useRef({}).current;\n  var viewNodes = React.useRef({}).current;\n  var _useConfigProvider = useConfigProvider(),\n    _useConfigProvider_transitionMotionEnabled = _useConfigProvider.transitionMotionEnabled,\n    transitionMotionEnabled = _useConfigProvider_transitionMotionEnabled === void 0 ? true : _useConfigProvider_transitionMotionEnabled;\n  var animate = React.useContext(SplitColContext).animate;\n  var disableAnimation = !transitionMotionEnabled || !animate;\n  var views = React.Children.toArray(children);\n  var _React_useState = _sliced_to_array(React.useState({\n      activeView: _activeView,\n      transition: false\n    }), 2),\n    _React_useState_ = _React_useState[0],\n    prevView = _React_useState_.prevView,\n    activeView = _React_useState_.activeView,\n    transition = _React_useState_.transition,\n    isBack = _React_useState_.isBack,\n    _setState = _React_useState[1];\n  var transitionTo = function (panel) {\n    if (panel !== activeView) {\n      var viewIds = views.map(function (view) {\n        return getNavId(view.props, warn);\n      });\n      var isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: !disableAnimation,\n        isBack: isBack\n      });\n    }\n  };\n  var finishTransition = React.useCallback(function () {\n    return _setState({\n      activeView: activeView,\n      prevView: prevView,\n      isBack: isBack,\n      transition: false\n    });\n  }, [activeView, isBack, prevView]);\n  useIsomorphicLayoutEffect(function () {\n    document.activeElement.blur();\n  }, [activeView]);\n  // Нужен переход\n  useIsomorphicLayoutEffect(function () {\n    return transitionTo(_activeView);\n  }, [_activeView]);\n  useIsomorphicLayoutEffect(function () {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition && onTransition({\n        isBack: Boolean(isBack),\n        from: prevView,\n        to: activeView\n      });\n    }\n  }, [transition, prevView]);\n  var fallbackTransition = useTimeout(finishTransition, platform === Platform.IOS ? 600 : 300);\n  React.useEffect(function () {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n    fallbackTransition.set();\n  }, [fallbackTransition, transition]);\n  var onAnimationEnd = function (e) {\n    if ([\"vkuiroot-android-animation-hide-back\", \"vkuiroot-android-animation-show-forward\", \"vkuiroot-ios-animation-hide-back\", \"vkuiroot-ios-animation-show-forward\"].includes(e.animationName)) {\n      finishTransition();\n    }\n  };\n  return /*#__PURE__*/React.createElement(RootComponent, _object_spread_props(_object_spread({}, restProps), {\n    baseClassName: classNames(\"vkuiRoot\", platform === Platform.IOS && \"vkuiRoot--ios\", transition && \"vkuiRoot--transition\")\n  }), views.map(function (view) {\n    var viewId = getNavId(view.props, warn);\n    if (viewId !== activeView && !(transition && viewId === prevView)) {\n      return null;\n    }\n    var isTransitionTarget = transition && viewId === (isBack ? prevView : activeView);\n    var compensateScroll = transition && (viewId === prevView || isBack && viewId === activeView);\n    var _scrolls_viewId;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: viewId,\n      ref: function (e) {\n        return viewId && (viewNodes[viewId] = e);\n      },\n      onAnimationEnd: isTransitionTarget ? onAnimationEnd : undefined,\n      className: classNames(\"vkuiRoot__view\", transition && viewId === prevView && isBack && \"vkuiRoot__view--hide-back\", transition && viewId === prevView && !isBack && \"vkuiRoot__view--hide-forward\", transition && viewId === activeView && isBack && \"vkuiRoot__view--show-back\", transition && viewId === activeView && !isBack && \"vkuiRoot__view--show-forward\")\n    }, /*#__PURE__*/React.createElement(NavTransitionDirectionProvider, {\n      isBack: isBack\n    }, /*#__PURE__*/React.createElement(NavTransitionProvider, {\n      entering: transition && viewId === activeView\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"vkuiRoot__scrollCompensation\",\n      style: {\n        marginTop: compensateScroll ? viewId && -((_scrolls_viewId = scrolls[viewId]) !== null && _scrolls_viewId !== void 0 ? _scrolls_viewId : 0) : undefined\n      }\n    }, view))));\n  }));\n};","map":{"version":3,"names":["React","classNames","usePlatform","useTimeout","useDOM","getNavId","Platform","useIsomorphicLayoutEffect","warnOnce","ScrollContext","useConfigProvider","NavTransitionProvider","NavTransitionDirectionProvider","RootComponent","SplitColContext","warn","Root","_param","children","_activeView","activeView","onTransition","nav","restProps","_object_without_properties","scroll","useContext","platform","document","scrolls","useRef","current","viewNodes","_useConfigProvider","_useConfigProvider_transitionMotionEnabled","transitionMotionEnabled","animate","disableAnimation","views","Children","toArray","_React_useState","_sliced_to_array","useState","transition","_React_useState_","prevView","isBack","_setState","transitionTo","panel","viewIds","map","view","props","indexOf","getScroll","y","finishTransition","useCallback","activeElement","blur","scrollTo","Boolean","from","to","fallbackTransition","IOS","useEffect","clear","set","onAnimationEnd","e","includes","animationName","createElement","_object_spread_props","_object_spread","baseClassName","viewId","isTransitionTarget","compensateScroll","_scrolls_viewId","key","ref","undefined","className","entering","style","marginTop"],"sources":["../../../src/components/Root/Root.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useDOM } from '../../lib/dom';\nimport { getNavId, NavIdProps } from '../../lib/getNavId';\nimport { Platform } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { HTMLAttributesWithRootRef } from '../../types';\nimport { ScrollContext } from '../AppRoot/ScrollContext';\nimport { useConfigProvider } from '../ConfigProvider/ConfigProviderContext';\nimport { NavTransitionProvider } from '../NavTransitionContext/NavTransitionContext';\nimport { NavTransitionDirectionProvider } from '../NavTransitionDirectionContext/NavTransitionDirectionContext';\nimport { RootComponent } from '../RootComponent/RootComponent';\nimport { SplitColContext } from '../SplitCol/SplitColContext';\nimport styles from './Root.module.css';\n\nexport interface RootProps extends HTMLAttributesWithRootRef<HTMLDivElement>, NavIdProps {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  children: React.ReactElement | Iterable<React.ReactElement>;\n}\n\nexport interface RootState {\n  activeView: string;\n  transition: boolean;\n  isBack?: boolean;\n  prevView?: string;\n}\n\nconst warn = warnOnce('Root');\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Root\n */\nexport const Root = ({\n  children,\n  activeView: _activeView,\n  onTransition,\n  nav,\n  ...restProps\n}: RootProps) => {\n  const scroll = React.useContext(ScrollContext);\n  const platform = usePlatform();\n  const { document } = useDOM();\n  const scrolls = React.useRef<Record<string, number>>({}).current;\n  const viewNodes = React.useRef<Record<string, HTMLElement | null>>({}).current;\n\n  const { transitionMotionEnabled = true } = useConfigProvider();\n  const { animate } = React.useContext(SplitColContext);\n  const disableAnimation = !transitionMotionEnabled || !animate;\n\n  const views = React.Children.toArray(children) as React.ReactElement[];\n\n  const [{ prevView, activeView, transition, isBack }, _setState] = React.useState<RootState>({\n    activeView: _activeView,\n    transition: false,\n  });\n  const transitionTo = (panel: string) => {\n    if (panel !== activeView) {\n      const viewIds = views.map((view) => getNavId(view.props, warn));\n      const isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: !disableAnimation,\n        isBack,\n      });\n    }\n  };\n  const finishTransition = React.useCallback(\n    () => _setState({ activeView, prevView, isBack, transition: false }),\n    [activeView, isBack, prevView],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    (document!.activeElement as HTMLElement).blur();\n  }, [activeView]);\n\n  // Нужен переход\n  useIsomorphicLayoutEffect(() => transitionTo(_activeView), [_activeView]);\n  useIsomorphicLayoutEffect(() => {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition &&\n        onTransition({\n          isBack: Boolean(isBack),\n          from: prevView,\n          to: activeView,\n        });\n    }\n  }, [transition, prevView]);\n\n  const fallbackTransition = useTimeout(finishTransition, platform === Platform.IOS ? 600 : 300);\n  React.useEffect(() => {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n    fallbackTransition.set();\n  }, [fallbackTransition, transition]);\n\n  const onAnimationEnd = (e: React.AnimationEvent) => {\n    if (\n      [\n        styles['root-android-animation-hide-back'],\n        styles['root-android-animation-show-forward'],\n        styles['root-ios-animation-hide-back'],\n        styles['root-ios-animation-show-forward'],\n      ].includes(e.animationName)\n    ) {\n      finishTransition();\n    }\n  };\n\n  return (\n    <RootComponent\n      {...restProps}\n      baseClassName={classNames(\n        styles['Root'],\n        platform === Platform.IOS && styles['Root--ios'],\n        transition && styles['Root--transition'],\n      )}\n    >\n      {views.map((view) => {\n        const viewId = getNavId(view.props, warn);\n        if (viewId !== activeView && !(transition && viewId === prevView)) {\n          return null;\n        }\n        const isTransitionTarget = transition && viewId === (isBack ? prevView : activeView);\n        const compensateScroll =\n          transition && (viewId === prevView || (isBack && viewId === activeView));\n        return (\n          <div\n            key={viewId}\n            ref={(e) => viewId && (viewNodes[viewId] = e)}\n            onAnimationEnd={isTransitionTarget ? onAnimationEnd : undefined}\n            className={classNames(\n              styles['Root__view'],\n              transition && viewId === prevView && isBack && styles['Root__view--hide-back'],\n              transition && viewId === prevView && !isBack && styles['Root__view--hide-forward'],\n              transition && viewId === activeView && isBack && styles['Root__view--show-back'],\n              transition && viewId === activeView && !isBack && styles['Root__view--show-forward'],\n            )}\n          >\n            <NavTransitionDirectionProvider isBack={isBack}>\n              <NavTransitionProvider entering={transition && viewId === activeView}>\n                <div\n                  className={styles['Root__scrollCompensation']}\n                  style={{\n                    marginTop: compensateScroll ? viewId && -(scrolls[viewId] ?? 0) : undefined,\n                  }}\n                >\n                  {view}\n                </div>\n              </NavTransitionProvider>\n            </NavTransitionDirectionProvider>\n          </div>\n        );\n      })}\n    </RootComponent>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}