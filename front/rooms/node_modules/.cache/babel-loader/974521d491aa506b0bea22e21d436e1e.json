{"ast":null,"code":"import { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nexport var useDraggable = function (param) {\n  var rootElRef = param.rootElRef,\n    onDragFinish = param.onDragFinish;\n  var _React_useState = _sliced_to_array(React.useState(false), 2),\n    dragging = _React_useState[0],\n    setDragging = _React_useState[1];\n  var _React_useState1 = _sliced_to_array(React.useState([]), 2),\n    siblings = _React_useState1[0],\n    setSiblings = _React_useState1[1];\n  var _React_useState2 = _sliced_to_array(React.useState(0), 2),\n    dragStartIndex = _React_useState2[0],\n    setDragStartIndex = _React_useState2[1];\n  var _React_useState3 = _sliced_to_array(React.useState(0), 2),\n    dragEndIndex = _React_useState3[0],\n    setDragEndIndex = _React_useState3[1];\n  var _React_useState4 = _sliced_to_array(React.useState(0), 2),\n    dragShift = _React_useState4[0],\n    setDragShift = _React_useState4[1];\n  var _React_useState5 = _sliced_to_array(React.useState(undefined), 2),\n    dragDirection = _React_useState5[0],\n    setDragDirection = _React_useState5[1];\n  var onDragStart = function (event) {\n    var _rootEl_parentElement;\n    var rootEl = rootElRef.current;\n    if (!rootEl) {\n      return;\n    }\n    event.originalEvent.stopPropagation();\n    event.originalEvent.preventDefault();\n    setDragging(true);\n    var _siblings = [];\n    if ((_rootEl_parentElement = rootEl.parentElement) === null || _rootEl_parentElement === void 0 ? void 0 : _rootEl_parentElement.childNodes) {\n      _siblings = Array.from(rootEl.parentElement.children);\n    }\n    var idx = _siblings.indexOf(rootEl);\n    setDragStartIndex(idx);\n    setDragEndIndex(idx);\n    setSiblings(_siblings);\n    setDragShift(0);\n  };\n  var onDragMove = function (event) {\n    event.originalEvent.stopPropagation();\n    event.originalEvent.preventDefault();\n    var rootEl = rootElRef.current;\n    if (rootEl) {\n      rootEl.style.transform = \"translateY(\".concat(event.shiftY, \"px)\");\n      var rootGesture = rootEl.getBoundingClientRect();\n      setDragDirection(dragShift - event.shiftY < 0 ? \"down\" : \"up\");\n      setDragShift(event.shiftY);\n      setDragEndIndex(dragStartIndex);\n      siblings.forEach(function (sibling, siblingIndex) {\n        var siblingGesture = sibling.getBoundingClientRect();\n        var siblingHalfHeight = siblingGesture.height / 2;\n        var rootOverSibling = rootGesture.bottom > siblingGesture.top + siblingHalfHeight;\n        var rootUnderSibling = rootGesture.top < siblingGesture.bottom - siblingHalfHeight;\n        if (dragStartIndex < siblingIndex) {\n          if (rootOverSibling) {\n            if (dragDirection === \"down\") {\n              sibling.style.transform = \"translateY(-100%)\";\n            }\n            setDragEndIndex(function (dragEndIndex) {\n              return dragEndIndex + 1;\n            });\n          }\n          if (rootUnderSibling && dragDirection === \"up\") {\n            sibling.style.transform = \"translateY(0)\";\n          }\n        } else if (dragStartIndex > siblingIndex) {\n          if (rootUnderSibling) {\n            if (dragDirection === \"up\") {\n              sibling.style.transform = \"translateY(100%)\";\n            }\n            setDragEndIndex(function (dragEndIndex) {\n              return dragEndIndex - 1;\n            });\n          }\n          if (rootOverSibling && dragDirection === \"down\") {\n            sibling.style.transform = \"translateY(0)\";\n          }\n        }\n      });\n    }\n  };\n  var onDragEnd = function (event) {\n    event.originalEvent.stopPropagation();\n    event.originalEvent.preventDefault();\n    var _ref = [dragStartIndex, dragEndIndex],\n      from = _ref[0],\n      to = _ref[1];\n    siblings.forEach(function (sibling) {\n      sibling.style.transform = \"\";\n    });\n    setSiblings([]);\n    setDragEndIndex(0);\n    setDragStartIndex(0);\n    setDragDirection(undefined);\n    setDragShift(0);\n    setDragging(false);\n    onDragFinish && onDragFinish({\n      from: from,\n      to: to\n    });\n  };\n  var useDraggableProps = {\n    onDragStart: onDragStart,\n    onDragMove: onDragMove,\n    onDragEnd: onDragEnd,\n    dragging: dragging\n  };\n  return useDraggableProps;\n};","map":{"version":3,"names":["React","useDraggable","param","rootElRef","onDragFinish","_React_useState","_sliced_to_array","useState","dragging","setDragging","_React_useState1","siblings","setSiblings","_React_useState2","dragStartIndex","setDragStartIndex","_React_useState3","dragEndIndex","setDragEndIndex","_React_useState4","dragShift","setDragShift","_React_useState5","undefined","dragDirection","setDragDirection","onDragStart","event","_rootEl_parentElement","rootEl","current","originalEvent","stopPropagation","preventDefault","_siblings","parentElement","childNodes","Array","from","children","idx","indexOf","onDragMove","style","transform","concat","shiftY","rootGesture","getBoundingClientRect","forEach","sibling","siblingIndex","siblingGesture","siblingHalfHeight","height","rootOverSibling","bottom","top","rootUnderSibling","onDragEnd","_ref","to","useDraggableProps"],"sources":["../../../src/components/Cell/useDraggable.tsx"],"sourcesContent":["import * as React from 'react';\nimport { TouchEvent } from '../Touch/Touch';\nimport { CellProps } from './Cell';\n\nexport interface DraggableProps {\n  onDragStart(event: TouchEvent): void;\n  onDragEnd(event: TouchEvent): void;\n  onDragMove(event: TouchEvent): void;\n}\n\ninterface UseDraggableProps extends DraggableProps {\n  dragging: boolean;\n}\n\nexport const useDraggable = <T extends HTMLElement>({\n  rootElRef,\n  onDragFinish,\n}: Pick<CellProps, 'onDragFinish'> & {\n  rootElRef: React.MutableRefObject<T | null>;\n}) => {\n  const [dragging, setDragging] = React.useState<boolean>(false);\n\n  const [siblings, setSiblings] = React.useState<HTMLElement[]>([]);\n  const [dragStartIndex, setDragStartIndex] = React.useState<number>(0);\n  const [dragEndIndex, setDragEndIndex] = React.useState<number>(0);\n  const [dragShift, setDragShift] = React.useState<number>(0);\n  const [dragDirection, setDragDirection] = React.useState<'down' | 'up' | undefined>(undefined);\n\n  const onDragStart = (event: TouchEvent) => {\n    const rootEl = rootElRef.current;\n    if (!rootEl) {\n      return;\n    }\n    event.originalEvent.stopPropagation();\n    event.originalEvent.preventDefault();\n\n    setDragging(true);\n\n    let _siblings: HTMLElement[] = [];\n    if (rootEl.parentElement?.childNodes) {\n      _siblings = Array.from(rootEl.parentElement.children) as HTMLElement[];\n    }\n    const idx = _siblings.indexOf(rootEl);\n\n    setDragStartIndex(idx);\n    setDragEndIndex(idx);\n    setSiblings(_siblings);\n    setDragShift(0);\n  };\n\n  const onDragMove = (event: TouchEvent) => {\n    event.originalEvent.stopPropagation();\n    event.originalEvent.preventDefault();\n\n    const rootEl = rootElRef.current;\n\n    if (rootEl) {\n      rootEl.style.transform = `translateY(${event.shiftY}px)`;\n      const rootGesture = rootEl.getBoundingClientRect();\n\n      setDragDirection(dragShift - event.shiftY < 0 ? 'down' : 'up');\n      setDragShift(event.shiftY);\n      setDragEndIndex(dragStartIndex);\n\n      siblings.forEach((sibling: HTMLElement, siblingIndex: number) => {\n        const siblingGesture = sibling.getBoundingClientRect();\n        const siblingHalfHeight = siblingGesture.height / 2;\n\n        const rootOverSibling = rootGesture.bottom > siblingGesture.top + siblingHalfHeight;\n        const rootUnderSibling = rootGesture.top < siblingGesture.bottom - siblingHalfHeight;\n\n        if (dragStartIndex < siblingIndex) {\n          if (rootOverSibling) {\n            if (dragDirection === 'down') {\n              sibling.style.transform = 'translateY(-100%)';\n            }\n\n            setDragEndIndex((dragEndIndex) => dragEndIndex + 1);\n          }\n          if (rootUnderSibling && dragDirection === 'up') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        } else if (dragStartIndex > siblingIndex) {\n          if (rootUnderSibling) {\n            if (dragDirection === 'up') {\n              sibling.style.transform = 'translateY(100%)';\n            }\n\n            setDragEndIndex((dragEndIndex) => dragEndIndex - 1);\n          }\n          if (rootOverSibling && dragDirection === 'down') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        }\n      });\n    }\n  };\n\n  const onDragEnd = (event: TouchEvent) => {\n    event.originalEvent.stopPropagation();\n    event.originalEvent.preventDefault();\n\n    const [from, to] = [dragStartIndex, dragEndIndex];\n\n    siblings.forEach((sibling: HTMLElement) => {\n      sibling.style.transform = '';\n    });\n\n    setSiblings([]);\n    setDragEndIndex(0);\n    setDragStartIndex(0);\n    setDragDirection(undefined);\n    setDragShift(0);\n\n    setDragging(false);\n\n    onDragFinish && onDragFinish({ from, to });\n  };\n\n  const useDraggableProps: UseDraggableProps = {\n    onDragStart,\n    onDragMove,\n    onDragEnd,\n    dragging,\n  };\n\n  return useDraggableProps;\n};\n"],"mappings":";AAAA,YAAYA,KAAA,MAAW;AAcvB,OAAO,IAAMC,YAAA,GAAe,SAAAA,CAAAC,KAAA;MAC1BC,SAAA,GAAAD,KAAA,CAAAC,SAAA;IACAC,YAAA,GAAAF,KAAA,CAAAE,YAAA;EAIA,IAAgCC,eAAA,GAAAC,gBAAA,CAAAN,KAAA,CAAMO,QAAQ,CAAU;IAAjDC,QAAA,GAAyBH,eAAA;IAAfI,WAAA,GAAeJ,eAAA;EAEhC,IAAgCK,gBAAA,GAAAJ,gBAAA,CAAAN,KAAA,CAAMO,QAAQ,CAAgB,EAAE;IAAzDI,QAAA,GAAyBD,gBAAA;IAAfE,WAAA,GAAeF,gBAAA;EAChC,IAA4CG,gBAAA,GAAAP,gBAAA,CAAAN,KAAA,CAAMO,QAAQ,CAAS;IAA5DO,cAAA,GAAqCD,gBAAA;IAArBE,iBAAA,GAAqBF,gBAAA;EAC5C,IAAwCG,gBAAA,GAAAV,gBAAA,CAAAN,KAAA,CAAMO,QAAQ,CAAS;IAAxDU,YAAA,GAAiCD,gBAAA;IAAnBE,eAAA,GAAmBF,gBAAA;EACxC,IAAkCG,gBAAA,GAAAb,gBAAA,CAAAN,KAAA,CAAMO,QAAQ,CAAS;IAAlDa,SAAA,GAA2BD,gBAAA;IAAhBE,YAAA,GAAgBF,gBAAA;EAClC,IAA0CG,gBAAA,GAAAhB,gBAAA,CAAAN,KAAA,CAAMO,QAAQ,CAA4BgB,SAAA;IAA7EC,aAAA,GAAmCF,gBAAA;IAApBG,gBAAA,GAAoBH,gBAAA;EAE1C,IAAMI,WAAA,GAAc,SAAAA,CAACC,KAAA;QAWfC,qBAAA;IAVJ,IAAMC,MAAA,GAAS1B,SAAA,CAAU2B,OAAO;IAChC,IAAI,CAACD,MAAA,EAAQ;MACX;IACF;IACAF,KAAA,CAAMI,aAAa,CAACC,eAAe;IACnCL,KAAA,CAAMI,aAAa,CAACE,cAAc;IAElCxB,WAAA,CAAY;IAEZ,IAAIyB,SAAA,GAA2B,EAAE;IACjC,KAAIN,qBAAA,GAAAC,MAAA,CAAOM,aAAa,cAApBP,qBAAA,uBAAAA,qBAAA,CAAsBQ,UAAU,EAAE;MACpCF,SAAA,GAAYG,KAAA,CAAMC,IAAI,CAACT,MAAA,CAAOM,aAAa,CAACI,QAAQ;IACtD;IACA,IAAMC,GAAA,GAAMN,SAAA,CAAUO,OAAO,CAACZ,MAAA;IAE9Bd,iBAAA,CAAkByB,GAAA;IAClBtB,eAAA,CAAgBsB,GAAA;IAChB5B,WAAA,CAAYsB,SAAA;IACZb,YAAA,CAAa;EACf;EAEA,IAAMqB,UAAA,GAAa,SAAAA,CAACf,KAAA;IAClBA,KAAA,CAAMI,aAAa,CAACC,eAAe;IACnCL,KAAA,CAAMI,aAAa,CAACE,cAAc;IAElC,IAAMJ,MAAA,GAAS1B,SAAA,CAAU2B,OAAO;IAEhC,IAAID,MAAA,EAAQ;MACVA,MAAA,CAAOc,KAAK,CAACC,SAAS,GAAG,aAAC,CAA0BC,MAAA,CAAblB,KAAA,CAAMmB,MAAM,EAAC;MACpD,IAAMC,WAAA,GAAclB,MAAA,CAAOmB,qBAAqB;MAEhDvB,gBAAA,CAAiBL,SAAA,GAAYO,KAAA,CAAMmB,MAAM,GAAG,IAAI,SAAS;MACzDzB,YAAA,CAAaM,KAAA,CAAMmB,MAAM;MACzB5B,eAAA,CAAgBJ,cAAA;MAEhBH,QAAA,CAASsC,OAAO,CAAC,UAACC,OAAA,EAAsBC,YAAA;QACtC,IAAMC,cAAA,GAAiBF,OAAA,CAAQF,qBAAqB;QACpD,IAAMK,iBAAA,GAAoBD,cAAA,CAAeE,MAAM,GAAG;QAElD,IAAMC,eAAA,GAAkBR,WAAA,CAAYS,MAAM,GAAGJ,cAAA,CAAeK,GAAG,GAAGJ,iBAAA;QAClE,IAAMK,gBAAA,GAAmBX,WAAA,CAAYU,GAAG,GAAGL,cAAA,CAAeI,MAAM,GAAGH,iBAAA;QAEnE,IAAIvC,cAAA,GAAiBqC,YAAA,EAAc;UACjC,IAAII,eAAA,EAAiB;YACnB,IAAI/B,aAAA,KAAkB,QAAQ;cAC5B0B,OAAA,CAAQP,KAAK,CAACC,SAAS,GAAG;YAC5B;YAEA1B,eAAA,CAAgB,UAACD,YAAA;qBAAiBA,YAAA,GAAe;;UACnD;UACA,IAAIyC,gBAAA,IAAoBlC,aAAA,KAAkB,MAAM;YAC9C0B,OAAA,CAAQP,KAAK,CAACC,SAAS,GAAG;UAC5B;QACF,OAAO,IAAI9B,cAAA,GAAiBqC,YAAA,EAAc;UACxC,IAAIO,gBAAA,EAAkB;YACpB,IAAIlC,aAAA,KAAkB,MAAM;cAC1B0B,OAAA,CAAQP,KAAK,CAACC,SAAS,GAAG;YAC5B;YAEA1B,eAAA,CAAgB,UAACD,YAAA;qBAAiBA,YAAA,GAAe;;UACnD;UACA,IAAIsC,eAAA,IAAmB/B,aAAA,KAAkB,QAAQ;YAC/C0B,OAAA,CAAQP,KAAK,CAACC,SAAS,GAAG;UAC5B;QACF;MACF;IACF;EACF;EAEA,IAAMe,SAAA,GAAY,SAAAA,CAAChC,KAAA;IACjBA,KAAA,CAAMI,aAAa,CAACC,eAAe;IACnCL,KAAA,CAAMI,aAAa,CAACE,cAAc;IAElC,IAAmB2B,IAAA,IAAC9C,cAAA,EAAgBG,YAAA,CAAa;MAA1CqB,IAAA,GAAYsB,IAAA;MAANC,EAAA,GAAMD,IAAA;IAEnBjD,QAAA,CAASsC,OAAO,CAAC,UAACC,OAAA;MAChBA,OAAA,CAAQP,KAAK,CAACC,SAAS,GAAG;IAC5B;IAEAhC,WAAA,CAAY,EAAE;IACdM,eAAA,CAAgB;IAChBH,iBAAA,CAAkB;IAClBU,gBAAA,CAAiBF,SAAA;IACjBF,YAAA,CAAa;IAEbZ,WAAA,CAAY;IAEZL,YAAA,IAAgBA,YAAA,CAAa;MAAEkC,IAAA,EAAAA,IAAA;MAAMuB,EAAA,EAAAA;IAAG;EAC1C;EAEA,IAAMC,iBAAA,GAAuC;IAC3CpC,WAAA,EAAAA,WAAA;IACAgB,UAAA,EAAAA,UAAA;IACAiB,SAAA,EAAAA,SAAA;IACAnD,QAAA,EAAAA;EACF;EAEA,OAAOsD,iBAAA;AACT"},"metadata":{},"sourceType":"module"}