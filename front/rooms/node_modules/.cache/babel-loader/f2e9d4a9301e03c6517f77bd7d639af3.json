{"ast":null,"code":"import { _ as _class_call_check } from \"@swc/helpers/_/_class_call_check\";\nimport { _ as _create_class } from \"@swc/helpers/_/_create_class\";\nimport { _ as _define_property } from \"@swc/helpers/_/_define_property\";\nimport { _ as _instanceof } from \"@swc/helpers/_/_instanceof\";\nvar CustomStorage = /*#__PURE__*/function () {\n  \"use strict\";\n\n  function CustomStorage() {\n    var _this = this;\n    _class_call_check(this, CustomStorage);\n    _define_property(this, \"data\", {});\n    _define_property(this, \"getItem\", function (key) {\n      return _this.data.hasOwnProperty(key) ? _this.data[key] : null;\n    });\n    _define_property(this, \"keys\", function () {\n      return Object.keys(_this.data);\n    });\n  }\n  _create_class(CustomStorage, [{\n    key: \"setItem\",\n    value: function setItem(key, val) {\n      this.data[key] = String(val);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(id) {\n      delete this.data[id];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.data = {};\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return Object.keys(this.data).length;\n    }\n  }, {\n    key: \"key\",\n    value: function key(index) {\n      return Object.keys(this.data)[index];\n    }\n  }]);\n  return CustomStorage;\n}();\nvar dummyKey = \"vk-ls-dummy\";\nvar dummyContent = \"test\";\nvar ls;\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error(\"localStorage is broken\");\n    }\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n  return ls;\n}\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\nexport var localStorage = {\n  setItem: function (key, val) {\n    return getLocalStorage().setItem(key, val);\n  },\n  getItem: function (key) {\n    return getLocalStorage().getItem(key);\n  },\n  removeItem: function (key) {\n    return getLocalStorage().removeItem(key);\n  },\n  clear: function () {\n    return getLocalStorage().clear();\n  },\n  length: function () {\n    return getLocalStorage().length;\n  },\n  key: function (index) {\n    return getLocalStorage().key(index);\n  },\n  keys: function keys() {\n    var storage = getLocalStorage();\n    if (_instanceof(storage, CustomStorage)) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: function (prefix) {\n    return localStorage.keys().filter(function (key) {\n      return key.startsWith(prefix);\n    });\n  }\n};\nvar sessionStorageCache;\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error(\"sessionStorage is broken\");\n    }\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n  return sessionStorageCache;\n}\nexport var sessionStorage = {\n  setItem: function (key, val) {\n    return getSessionStorage().setItem(key, val);\n  },\n  getItem: function (key) {\n    return getSessionStorage().getItem(key);\n  },\n  removeItem: function (key) {\n    return getSessionStorage().removeItem(key);\n  },\n  clear: function () {\n    return getSessionStorage().clear();\n  },\n  length: function () {\n    return getSessionStorage().length;\n  },\n  key: function (index) {\n    return getSessionStorage().key(index);\n  },\n  keys: function keys() {\n    var storage = getSessionStorage();\n    if (_instanceof(storage, CustomStorage)) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: function (prefix) {\n    return sessionStorage.keys().filter(function (key) {\n      return key.startsWith(prefix);\n    });\n  }\n};","map":{"version":3,"names":["CustomStorage","_define_property","key","_this","data","hasOwnProperty","Object","keys","setItem","val","String","removeItem","id","clear","get","length","index","dummyKey","dummyContent","ls","getLocalStorage","window","localStorage","getItem","Error","e","storage","_instanceof","getPrefixedKeys","prefix","filter","startsWith","sessionStorageCache","getSessionStorage","sessionStorage"],"sources":["../../src/storage.ts"],"sourcesContent":["import { Dictionary } from './types';\n\nclass CustomStorage {\n  private data: Dictionary<string> = {};\n\n  public setItem(key: string, val: string) {\n    this.data[key] = String(val);\n  }\n\n  public getItem = (key: string) => (this.data.hasOwnProperty(key) ? this.data[key] : null);\n\n  public removeItem(id: string) {\n    delete this.data[id];\n  }\n\n  public clear() {\n    this.data = {};\n  }\n\n  public get length() {\n    return Object.keys(this.data).length;\n  }\n\n  public key(index: number): string | null {\n    return Object.keys(this.data)[index];\n  }\n\n  public keys = (): string[] => Object.keys(this.data);\n}\n\nconst dummyKey = 'vk-ls-dummy';\nconst dummyContent = 'test';\n\nlet ls: CustomStorage | Storage;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n  return ls;\n}\n\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\nexport const localStorage = {\n  setItem: (key: string, val: string) => getLocalStorage().setItem(key, val),\n  getItem: (key: string) => getLocalStorage().getItem(key),\n  removeItem: (key: string) => getLocalStorage().removeItem(key),\n  clear: () => getLocalStorage().clear(),\n  length: () => getLocalStorage().length,\n  key: (index: number) => getLocalStorage().key(index),\n  keys(): string[] {\n    const storage = getLocalStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => {\n    return localStorage.keys().filter((key) => key.startsWith(prefix));\n  },\n};\n\nlet sessionStorageCache: CustomStorage | Storage;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n  return sessionStorageCache;\n}\n\nexport const sessionStorage = {\n  setItem: (key: string, val: string) => getSessionStorage().setItem(key, val),\n  getItem: (key: string) => getSessionStorage().getItem(key),\n  removeItem: (key: string) => getSessionStorage().removeItem(key),\n  clear: () => getSessionStorage().clear(),\n  length: () => getSessionStorage().length,\n  key: (index: number) => getSessionStorage().key(index),\n  keys(): string[] {\n    const storage = getSessionStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => {\n    return sessionStorage.keys().filter((key) => key.startsWith(prefix));\n  },\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}