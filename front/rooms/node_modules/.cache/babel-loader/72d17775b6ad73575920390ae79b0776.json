{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { classNames, hasReactNode } from \"@vkontakte/vkjs\";\nimport { useEnsuredControl } from \"../../hooks/useEnsuredControl\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { Platform } from \"../../lib/platform\";\nimport { Headline } from \"../Typography/Headline/Headline\";\nimport { Title } from \"../Typography/Title/Title\";\nvar WriteBarTypography = function (props) {\n  var platform = usePlatform();\n  if (platform === Platform.IOS) {\n    return /*#__PURE__*/React.createElement(Title, _object_spread_props(_object_spread({}, props), {\n      level: \"3\",\n      weight: \"3\"\n    }));\n  }\n  return /*#__PURE__*/React.createElement(Headline, props);\n};\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport var WriteBar = function (_param) {\n  var className = _param.className,\n    style = _param.style,\n    before = _param.before,\n    inlineAfter = _param.inlineAfter,\n    after = _param.after,\n    getRootRef = _param.getRootRef,\n    getRef = _param.getRef,\n    onHeightChange = _param.onHeightChange,\n    _param_shadow = _param.shadow,\n    shadow = _param_shadow === void 0 ? false : _param_shadow,\n    defaultValue = _param.defaultValue,\n    restProps = _object_without_properties(_param, [\"className\", \"style\", \"before\", \"inlineAfter\", \"after\", \"getRootRef\", \"getRef\", \"onHeightChange\", \"shadow\", \"defaultValue\"]);\n  var platform = usePlatform();\n  var _useEnsuredControl = _sliced_to_array(useEnsuredControl(_object_spread({\n      defaultValue: defaultValue\n    }, restProps)), 2),\n    value = _useEnsuredControl[0],\n    onChange = _useEnsuredControl[1];\n  var textareaRef = useExternRef(getRef);\n  var currentScrollHeight = React.useRef();\n  var resize = React.useCallback(function () {\n    var textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = \"\";\n      textareaEl.style.height = \"\".concat(textareaEl.scrollHeight, \"px\");\n      if (textareaEl.scrollHeight !== currentScrollHeight.current && onHeightChange) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n  React.useEffect(resize, [resize, value, platform]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: getRootRef,\n    className: classNames(\"vkuiWriteBar\", platform === Platform.IOS && \"vkuiWriteBar--ios\", shadow && \"vkuiWriteBar--shadow\", className),\n    style: style\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiWriteBar__form\"\n  }, hasReactNode(before) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiWriteBar__before\"\n  }, before), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiWriteBar__formIn\"\n  }, /*#__PURE__*/React.createElement(WriteBarTypography, _object_spread_props(_object_spread({}, restProps), {\n    Component: \"textarea\",\n    className: \"vkuiWriteBar__textarea\",\n    onChange: onChange,\n    getRootRef: textareaRef,\n    value: value\n  })), hasReactNode(inlineAfter) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiWriteBar__inlineAfter\"\n  }, inlineAfter)), hasReactNode(after) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiWriteBar__after\"\n  }, after)));\n};","map":{"version":3,"names":["React","classNames","hasReactNode","useEnsuredControl","useExternRef","usePlatform","Platform","Headline","Title","WriteBarTypography","props","platform","IOS","createElement","_object_spread_props","_object_spread","level","weight","WriteBar","_param","className","style","before","inlineAfter","after","getRootRef","getRef","onHeightChange","_param_shadow","shadow","defaultValue","restProps","_object_without_properties","_useEnsuredControl","_sliced_to_array","value","onChange","textareaRef","currentScrollHeight","useRef","resize","useCallback","textareaEl","current","offsetParent","height","concat","scrollHeight","useEffect","ref","Component"],"sources":["../../../src/components/WriteBar/WriteBar.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames, hasReactNode } from '@vkontakte/vkjs';\nimport { useEnsuredControl } from '../../hooks/useEnsuredControl';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { Platform } from '../../lib/platform';\nimport { HasRef, HasRootRef } from '../../types';\nimport { Headline } from '../Typography/Headline/Headline';\nimport { Title } from '../Typography/Title/Title';\nimport { TypographyProps } from '../Typography/Typography';\nimport styles from './WriteBar.module.css';\n\nexport interface WriteBarProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\n    HasRootRef<HTMLDivElement>,\n    HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слева от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n  /**\n   * Добавляет тень вокруг поля ввода\n   */\n  shadow?: boolean;\n\n  children?: never;\n}\n\nconst WriteBarTypography = (props: TypographyProps) => {\n  const platform = usePlatform();\n\n  if (platform === Platform.IOS) {\n    return <Title {...props} level=\"3\" weight=\"3\" />;\n  }\n\n  return <Headline {...props} />;\n};\n\n/**\n * @see https://vkcom.github.io/VKUI/#/WriteBar\n */\nexport const WriteBar = ({\n  className,\n  style,\n  before,\n  inlineAfter,\n  after,\n  getRootRef,\n  getRef,\n  onHeightChange,\n  shadow = false,\n  defaultValue,\n  ...restProps\n}: WriteBarProps) => {\n  const platform = usePlatform();\n\n  const [value, onChange] = useEnsuredControl({\n    defaultValue,\n    ...restProps,\n  });\n\n  const textareaRef = useExternRef(getRef);\n  const currentScrollHeight = React.useRef<number>();\n\n  const resize = React.useCallback(() => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    if (textareaEl.offsetParent) {\n      textareaEl.style.height = '';\n      textareaEl.style.height = `${textareaEl.scrollHeight}px`;\n\n      if (textareaEl.scrollHeight !== currentScrollHeight.current && onHeightChange) {\n        onHeightChange();\n        currentScrollHeight.current = textareaEl.scrollHeight;\n      }\n    }\n  }, [onHeightChange, textareaRef]);\n\n  React.useEffect(resize, [resize, value, platform]);\n\n  return (\n    <div\n      ref={getRootRef}\n      className={classNames(\n        styles['WriteBar'],\n        platform === Platform.IOS && styles['WriteBar--ios'],\n        shadow && styles['WriteBar--shadow'],\n        className,\n      )}\n      style={style}\n    >\n      <div className={styles['WriteBar__form']}>\n        {hasReactNode(before) && <div className={styles['WriteBar__before']}>{before}</div>}\n\n        <div className={styles['WriteBar__formIn']}>\n          <WriteBarTypography\n            {...restProps}\n            Component=\"textarea\"\n            className={styles['WriteBar__textarea']}\n            onChange={onChange}\n            getRootRef={textareaRef}\n            value={value}\n          />\n          {hasReactNode(inlineAfter) && (\n            <div className={styles['WriteBar__inlineAfter']}>{inlineAfter}</div>\n          )}\n        </div>\n\n        {hasReactNode(after) && <div className={styles['WriteBar__after']}>{after}</div>}\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}