{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { noop } from \"@vkontakte/vkjs\";\nimport { useAdaptivityWithJSMediaQueries } from \"../../hooks/useAdaptivityWithJSMediaQueries\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { Platform } from \"../../lib/platform\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useScrollLock } from \"../AppRoot/ScrollContext\";\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { Footnote } from \"../Typography/Footnote/Footnote\";\nimport { ActionSheetContext } from \"./ActionSheetContext\";\nimport { ActionSheetDefaultIosCloseItem } from \"./ActionSheetDefaultIosCloseItem\";\nimport { ActionSheetDropdownMenu } from \"./ActionSheetDropdownMenu\";\nimport { ActionSheetDropdownSheet } from \"./ActionSheetDropdownSheet\";\nvar warn = warnOnce(\"ActionSheet\");\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport var ActionSheet = function (_param) {\n  var children = _param.children,\n    className = _param.className,\n    header = _param.header,\n    text = _param.text,\n    style = _param.style,\n    iosCloseItem = _param.iosCloseItem,\n    popupDirection = _param.popupDirection,\n    popupOffsetDistance = _param.popupOffsetDistance,\n    placement = _param.placement,\n    modeProp = _param.mode,\n    restProps = _object_without_properties(_param, [\"children\", \"className\", \"header\", \"text\", \"style\", \"iosCloseItem\", \"popupDirection\", \"popupOffsetDistance\", \"placement\", \"mode\"]);\n  var platform = usePlatform();\n  var _React_useState = _sliced_to_array(React.useState(undefined), 2),\n    closingBy = _React_useState[0],\n    setClosingBy = _React_useState[1];\n  var onClose = function () {\n    return setClosingBy(\"other\");\n  };\n  var _action = React.useRef(noop);\n  var afterClose = function () {\n    restProps.onClose({\n      closedBy: closingBy || \"other\"\n    });\n    _action.current();\n    _action.current = noop;\n  };\n  var isDesktop = useAdaptivityWithJSMediaQueries().isDesktop;\n  var mode = modeProp !== null && modeProp !== void 0 ? modeProp : isDesktop ? \"menu\" : \"sheet\";\n  useScrollLock(mode === \"sheet\");\n  var timeout = platform === Platform.IOS ? 300 : 200;\n  if (mode === \"menu\") {\n    timeout = 0;\n  }\n  var fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(function () {\n    if (closingBy) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closingBy, fallbackTransitionFinish]);\n  var onItemClick = React.useCallback(function (param) {\n    var action = param.action,\n      immediateAction = param.immediateAction,\n      autoClose = param.autoClose,\n      isCancelItem = param.isCancelItem;\n    return function (event) {\n      event.persist();\n      immediateAction && immediateAction(event);\n      if (autoClose) {\n        _action.current = function () {\n          return action && action(event);\n        };\n        setClosingBy(isCancelItem ? \"cancel-item\" : \"action-item\");\n      } else {\n        action && action(event);\n      }\n    };\n  }, []);\n  var contextValue = useObjectMemo({\n    onItemClick: onItemClick,\n    mode: mode\n  });\n  var DropdownComponent = mode === \"menu\" ? ActionSheetDropdownMenu : ActionSheetDropdownSheet;\n  if (process.env.NODE_ENV === \"development\" && popupDirection) {\n    // TODO [>=6]: popupDirection\n    warn('Свойство \"popupDirection\" будет удалено в v6. Используйте свойство \"placement\"');\n  }\n  popupDirection = popupDirection !== undefined ? popupDirection : \"bottom\";\n  var dropdownProps = mode === \"menu\" ? Object.assign(restProps, {\n    popupOffsetDistance: popupOffsetDistance,\n    popupDirection: popupDirection,\n    placement: placement\n  }) : restProps;\n  var actionSheet = /*#__PURE__*/React.createElement(ActionSheetContext.Provider, {\n    value: contextValue\n  }, /*#__PURE__*/React.createElement(DropdownComponent, _object_spread_props(_object_spread({\n    closing: Boolean(closingBy),\n    timeout: timeout\n  }, dropdownProps), {\n    onClose: onClose,\n    className: mode === \"menu\" ? className : undefined,\n    style: mode === \"menu\" ? style : undefined\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiActionSheet__content-wrapper\"\n  }, (header || text) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiActionSheet__header\"\n  }, header && /*#__PURE__*/React.createElement(Footnote, {\n    weight: \"2\",\n    className: \"vkuiActionSheet__title\"\n  }, header), text && /*#__PURE__*/React.createElement(Footnote, {\n    className: \"vkuiActionSheet__text\"\n  }, text)), children), platform === Platform.IOS && mode === \"sheet\" && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiActionSheet__close-item-wrapper--ios\"\n  }, iosCloseItem !== null && iosCloseItem !== void 0 ? iosCloseItem : /*#__PURE__*/React.createElement(ActionSheetDefaultIosCloseItem, null))));\n  if (mode === \"menu\") {\n    return actionSheet;\n  }\n  return /*#__PURE__*/React.createElement(PopoutWrapper, {\n    closing: Boolean(closingBy),\n    alignY: \"bottom\",\n    className: className,\n    style: style,\n    onClick: onClose,\n    hasMask: true,\n    fixed: true\n  }, actionSheet);\n};","map":{"version":3,"names":["React","noop","useAdaptivityWithJSMediaQueries","useObjectMemo","usePlatform","useTimeout","Platform","warnOnce","useScrollLock","PopoutWrapper","Footnote","ActionSheetContext","ActionSheetDefaultIosCloseItem","ActionSheetDropdownMenu","ActionSheetDropdownSheet","warn","ActionSheet","_param","children","className","header","text","style","iosCloseItem","popupDirection","popupOffsetDistance","placement","modeProp","mode","restProps","_object_without_properties","platform","_React_useState","_sliced_to_array","useState","undefined","closingBy","setClosingBy","onClose","_action","useRef","afterClose","closedBy","current","isDesktop","timeout","IOS","fallbackTransitionFinish","useEffect","set","clear","onItemClick","useCallback","param","action","immediateAction","autoClose","isCancelItem","event","persist","contextValue","DropdownComponent","process","env","NODE_ENV","dropdownProps","Object","assign","actionSheet","createElement","Provider","value","_object_spread_props","_object_spread","closing","Boolean","weight","alignY","onClick","hasMask","fixed"],"sources":["../../../src/components/ActionSheet/ActionSheet.tsx"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { useAdaptivityWithJSMediaQueries } from '../../hooks/useAdaptivityWithJSMediaQueries';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { Platform } from '../../lib/platform';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { useScrollLock } from '../AppRoot/ScrollContext';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport { ActionSheetDefaultIosCloseItem } from './ActionSheetDefaultIosCloseItem';\nimport { ActionSheetDropdownMenu } from './ActionSheetDropdownMenu';\nimport { ActionSheetDropdownSheet } from './ActionSheetDropdownSheet';\nimport { SharedDropdownProps } from './types';\nimport styles from './ActionSheet.module.css';\n\nconst warn = warnOnce('ActionSheet');\ntype CloseInitiators = 'action-item' | 'cancel-item' | 'other';\nexport interface ActionSheetOnCloseOptions {\n  closedBy: CloseInitiators;\n}\n\nexport interface ActionSheetProps\n  extends Pick<\n      SharedDropdownProps,\n      'toggleRef' | 'popupDirection' | 'popupOffsetDistance' | 'placement'\n    >,\n    React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  /**\n   * Закрыть попап по клику снаружи.\n   */\n  onClose(options: ActionSheetOnCloseOptions): void;\n  /**\n   * Только мобильный iOS.\n   */\n  iosCloseItem?: React.ReactNode;\n  mode?: 'sheet' | 'menu';\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/ActionSheet\n */\nexport const ActionSheet = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  popupDirection,\n  popupOffsetDistance,\n  placement,\n  mode: modeProp,\n  ...restProps\n}: ActionSheetProps) => {\n  const platform = usePlatform();\n  const [closingBy, setClosingBy] = React.useState<undefined | CloseInitiators>(undefined);\n  const onClose = () => setClosingBy('other');\n  const _action = React.useRef(noop);\n\n  const afterClose = () => {\n    restProps.onClose({ closedBy: closingBy || 'other' });\n    _action.current();\n    _action.current = noop;\n  };\n\n  const { isDesktop } = useAdaptivityWithJSMediaQueries();\n  const mode = modeProp ?? (isDesktop ? 'menu' : 'sheet');\n\n  useScrollLock(mode === 'sheet');\n\n  let timeout = platform === Platform.IOS ? 300 : 200;\n\n  if (mode === 'menu') {\n    timeout = 0;\n  }\n\n  const fallbackTransitionFinish = useTimeout(afterClose, timeout);\n  React.useEffect(() => {\n    if (closingBy) {\n      fallbackTransitionFinish.set();\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closingBy, fallbackTransitionFinish]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>(\n    ({ action, immediateAction, autoClose, isCancelItem }) =>\n      (event) => {\n        event.persist();\n        immediateAction && immediateAction(event);\n        if (autoClose) {\n          _action.current = () => action && action(event);\n          setClosingBy(isCancelItem ? 'cancel-item' : 'action-item');\n        } else {\n          action && action(event);\n        }\n      },\n    [],\n  );\n  const contextValue = useObjectMemo({ onItemClick, mode });\n\n  const DropdownComponent = mode === 'menu' ? ActionSheetDropdownMenu : ActionSheetDropdownSheet;\n\n  if (process.env.NODE_ENV === 'development' && popupDirection) {\n    // TODO [>=6]: popupDirection\n    warn('Свойство \"popupDirection\" будет удалено в v6. Используйте свойство \"placement\"');\n  }\n\n  popupDirection = popupDirection !== undefined ? popupDirection : 'bottom';\n\n  const dropdownProps =\n    mode === 'menu'\n      ? Object.assign(restProps, { popupOffsetDistance, popupDirection, placement })\n      : restProps;\n\n  const actionSheet = (\n    <ActionSheetContext.Provider value={contextValue}>\n      <DropdownComponent\n        closing={Boolean(closingBy)}\n        timeout={timeout}\n        {...dropdownProps}\n        onClose={onClose}\n        className={mode === 'menu' ? className : undefined}\n        style={mode === 'menu' ? style : undefined}\n      >\n        <div className={styles['ActionSheet__content-wrapper']}>\n          {(header || text) && (\n            <div className={styles['ActionSheet__header']}>\n              {header && (\n                <Footnote weight=\"2\" className={styles['ActionSheet__title']}>\n                  {header}\n                </Footnote>\n              )}\n              {text && <Footnote className={styles['ActionSheet__text']}>{text}</Footnote>}\n            </div>\n          )}\n          {children}\n        </div>\n        {platform === Platform.IOS && mode === 'sheet' && (\n          <div className={styles['ActionSheet__close-item-wrapper--ios']}>\n            {iosCloseItem ?? <ActionSheetDefaultIosCloseItem />}\n          </div>\n        )}\n      </DropdownComponent>\n    </ActionSheetContext.Provider>\n  );\n\n  if (mode === 'menu') {\n    return actionSheet;\n  }\n\n  return (\n    <PopoutWrapper\n      closing={Boolean(closingBy)}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={onClose}\n      hasMask\n      fixed\n    >\n      {actionSheet}\n    </PopoutWrapper>\n  );\n};\n"],"mappings":";;;;AAAA,YAAYA,KAAA,MAAW;AACvB,SAASC,IAAI,QAAQ;AACrB,SAASC,+BAA+B,QAAQ;AAChD,SAASC,aAAa,QAAQ;AAC9B,SAASC,WAAW,QAAQ;AAC5B,SAASC,UAAU,QAAQ;AAC3B,SAASC,QAAQ,QAAQ;AACzB,SAASC,QAAQ,QAAQ;AACzB,SAASC,aAAa,QAAQ;AAC9B,SAASC,aAAa,QAAQ;AAC9B,SAASC,QAAQ,QAAQ;AACzB,SAASC,kBAAkB,QAA0B;AACrD,SAASC,8BAA8B,QAAQ;AAC/C,SAASC,uBAAuB,QAAQ;AACxC,SAASC,wBAAwB,QAAQ;AAIzC,IAAMC,IAAA,GAAOR,QAAA,CAAS;AAyBtB;;;AAGA,OAAO,IAAMS,WAAA,GAAc,SAAAA,CAAAC,MAAA;MACzBC,QAAA,GAAAD,MAAA,CAAAC,QAAA;IACAC,SAAA,GAAAF,MAAA,CAAAE,SAAA;IACAC,MAAA,GAAAH,MAAA,CAAAG,MAAA;IACAC,IAAA,GAAAJ,MAAA,CAAAI,IAAA;IACAC,KAAA,GAAAL,MAAA,CAAAK,KAAA;IACAC,YAAA,GAAAN,MAAA,CAAAM,YAAA;IACAC,cAAA,GAAAP,MAAA,CAAAO,cAAA;IACAC,mBAAA,GAAAR,MAAA,CAAAQ,mBAAA;IACAC,SAAA,GAAAT,MAAA,CAAAS,SAAA;IACAC,QAAM,GAAAV,MAAA,CAANW,IAAA;IACGC,SAAA,GAAAC,0BAAA,CAAAb,MAAA,GAVH,YACA,aACA,UACA,QACA,SACA,gBACA,kBACA,uBACA,aACA,O;EAGA,IAAMc,QAAA,GAAW3B,WAAA;EACjB,IAAkC4B,eAAA,GAAAC,gBAAA,CAAAjC,KAAA,CAAMkC,QAAQ,CAA8BC,SAAA;IAAvEC,SAAA,GAA2BJ,eAAA;IAAhBK,YAAA,GAAgBL,eAAA;EAClC,IAAMM,OAAA,GAAU,SAAAA,CAAA;WAAMD,YAAA,CAAa;;EACnC,IAAME,OAAA,GAAUvC,KAAA,CAAMwC,MAAM,CAACvC,IAAA;EAE7B,IAAMwC,UAAA,GAAa,SAAAA,CAAA;IACjBZ,SAAA,CAAUS,OAAO,CAAC;MAAEI,QAAA,EAAUN,SAAA,IAAa;IAAQ;IACnDG,OAAA,CAAQI,OAAO;IACfJ,OAAA,CAAQI,OAAO,GAAG1C,IAAA;EACpB;EAEA,IAAM2C,SAAE,GAAc1C,+BAAA,GAAd0C,SAAA;EACR,IAAMhB,IAAA,GAAOD,QAAA,aAAAA,QAAA,cAAAA,QAAA,GAAaiB,SAAA,GAAY,SAAS;EAE/CpC,aAAA,CAAcoB,IAAA,KAAS;EAEvB,IAAIiB,OAAA,GAAUd,QAAA,KAAazB,QAAA,CAASwC,GAAG,GAAG,MAAM;EAEhD,IAAIlB,IAAA,KAAS,QAAQ;IACnBiB,OAAA,GAAU;EACZ;EAEA,IAAME,wBAAA,GAA2B1C,UAAA,CAAWoC,UAAA,EAAYI,OAAA;EACxD7C,KAAA,CAAMgD,SAAS,CAAC;IACd,IAAIZ,SAAA,EAAW;MACbW,wBAAA,CAAyBE,GAAG;IAC9B,OAAO;MACLF,wBAAA,CAAyBG,KAAK;IAChC;EACF,GAAG,CAACd,SAAA,EAAWW,wBAAA,CAAyB;EAExC,IAAMI,WAAA,GAAcnD,KAAA,CAAMoD,WAAW,CACnC,UAAAC,KAAA;QAAGC,MAAA,GAAAD,KAAA,CAAAC,MAAA;MAAQC,eAAA,GAAAF,KAAA,CAAAE,eAAA;MAAiBC,SAAA,GAAAH,KAAA,CAAAG,SAAA;MAAWC,YAAA,GAAAJ,KAAA,CAAAI,YAAA;WACrC,UAACC,KAAA;MACCA,KAAA,CAAMC,OAAO;MACbJ,eAAA,IAAmBA,eAAA,CAAgBG,KAAA;MACnC,IAAIF,SAAA,EAAW;QACbjB,OAAA,CAAQI,OAAO,GAAG;iBAAMW,MAAA,IAAUA,MAAA,CAAOI,KAAA;;QACzCrB,YAAA,CAAaoB,YAAA,GAAe,gBAAgB;MAC9C,OAAO;QACLH,MAAA,IAAUA,MAAA,CAAOI,KAAA;MACnB;IACF;KACF,EAAE;EAEJ,IAAME,YAAA,GAAezD,aAAA,CAAc;IAAEgD,WAAA,EAAAA,WAAA;IAAavB,IAAA,EAAAA;EAAK;EAEvD,IAAMiC,iBAAA,GAAoBjC,IAAA,KAAS,SAASf,uBAAA,GAA0BC,wBAAA;EAEtE,IAAIgD,OAAA,CAAQC,GAAG,CAACC,QAAQ,KAAK,iBAAiBxC,cAAA,EAAgB;IAC5D;IACAT,IAAA,CAAK;EACP;EAEAS,cAAA,GAAiBA,cAAA,KAAmBW,SAAA,GAAYX,cAAA,GAAiB;EAEjE,IAAMyC,aAAA,GACJrC,IAAA,KAAS,SACLsC,MAAA,CAAOC,MAAM,CAACtC,SAAA,EAAW;IAAEJ,mBAAA,EAAAA,mBAAA;IAAqBD,cAAA,EAAAA,cAAA;IAAgBE,SAAA,EAAAA;EAAU,KAC1EG,SAAA;EAEN,IAAMuC,WAAA,gBACJpE,KAAA,CAAAqE,aAAA,CAAC1D,kBAAA,CAAmB2D,QAAQ;IAACC,KAAA,EAAOX;kBAClC5D,KAAA,CAAAqE,aAAA,CAACR,iBAAA,EAAAW,oBAAA,CAAAC,cAAA;IACCC,OAAA,EAASC,OAAA,CAAQvC,SAAA;IACjBS,OAAA,EAASA;KACLoB,aAAA;IACJ3B,OAAA,EAASA,OAAA;IACTnB,SAAA,EAAWS,IAAA,KAAS,SAAST,SAAA,GAAYgB,SAAA;IACzCb,KAAA,EAAOM,IAAA,KAAS,SAASN,KAAA,GAAQa;mBAEjCnC,KAAA,CAAAqE,aAAA,CAAC;IAAIlD,SAAS;KACX,CAACC,MAAA,IAAUC,IAAG,kBACbrB,KAAA,CAAAqE,aAAA,CAAC;IAAIlD,SAAS;KACXC,MAAA,iBACCpB,KAAA,CAAAqE,aAAA,CAAC3D,QAAA;IAASkE,MAAA,EAAO;IAAIzD,SAAS;KAC3BC,MAAA,GAGJC,IAAA,iBAAQrB,KAAA,CAAAqE,aAAA,CAAC3D,QAAA;IAASS,SAAS;KAAgCE,IAAA,IAG/DH,QAAA,GAEFa,QAAA,KAAazB,QAAA,CAASwC,GAAG,IAAIlB,IAAA,KAAS,wBACrC5B,KAAA,CAAAqE,aAAA,CAAC;IAAIlD,SAAS;KACXI,YAAA,aAAAA,YAAA,cAAAA,YAAA,gBAAgBvB,KAAA,CAAAqE,aAAA,CAACzD,8BAAA;EAO5B,IAAIgB,IAAA,KAAS,QAAQ;IACnB,OAAOwC,WAAA;EACT;EAEA,oBACEpE,KAAA,CAAAqE,aAAA,CAAC5D,aAAA;IACCiE,OAAA,EAASC,OAAA,CAAQvC,SAAA;IACjByC,MAAA,EAAO;IACP1D,SAAA,EAAWA,SAAA;IACXG,KAAA,EAAOA,KAAA;IACPwD,OAAA,EAASxC,OAAA;IACTyC,OAAA;IACAC,KAAA;KAECZ,WAAA;AAGP"},"metadata":{},"sourceType":"module"}