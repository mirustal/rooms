{"ast":null,"code":"import bridge from \"@vkontakte/vk-bridge\";\nimport { AppId } from \"../config\";\nimport { joinRoom } from \"../serverApi/serverApi\";\nexport var joinRoomOnStart = undefined;\nconst Scopes = {\n  friends: \"friends\",\n  photos: \"photos\",\n  audio: \"audio\",\n  video: \"video\",\n  stories: \"stories\",\n  pages: \"pages\",\n  menu: \"menu\",\n  status: \"status\",\n  notes: \"notes\",\n  messages: \"messages\",\n  wall: \"wall\",\n  ads: \"ads\",\n  offline: \"offline\",\n  docs: \"docs\",\n  groups: \"groups\",\n  notifications: \"notifications\",\n  stats: \"stats\",\n  email: \"email\",\n  market: \"market\",\n  phone_number: \"phone_number\"\n};\n\nasync function getAccessToken() {\n  let accessToken = undefined;\n  let scopes = Array.from(arguments);\n  if (scopes.length > 0) scopes = scopes.join(\",\");else scopes = '';\n  await bridge.send('VKWebAppGetAuthToken', {\n    app_id: AppId,\n    scope: scopes\n  }).then(data => {\n    if (data.access_token) accessToken = data.access_token;\n  }).catch(error => {\n    console.log(error);\n  });\n  return accessToken;\n}\n\nvar cachedStorage = {};\nvar launchParams = undefined;\nexport function pushToStorage(key, value) {\n  cachedStorage[key] = value;\n  console.log(key);\n  bridge.send('VKWebAppStorageSet', {\n    key: key,\n    value: value\n  }).then(data => {\n    if (data.result) console.log(`pushed to storage '${key}' with value:\\n${value}`);else console.error(`failed to push to storage '${key}' with value:\\n${value}`);\n  }).catch(error => {\n    console.log(error);\n  });\n}\nexport function clearTheStorage(keys) {\n  keys.split(\",\").filter(x => x !== '').forEach(key => {\n    bridge.send('VKWebAppStorageSet', {\n      key: key\n    }).then(data => {\n      if (data.result) {\n        console.log('you storage clear');\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n  });\n}\nexport async function getFromStorage(key) {\n  if (key in cachedStorage) {\n    return cachedStorage[key];\n  }\n\n  let value = undefined;\n  await bridge.send('VKWebAppStorageGet', {\n    keys: [key]\n  }).then(data => {\n    if (data.keys) {\n      value = data.keys[0].value;\n    }\n  }).catch(error => {\n    console.log(error);\n  });\n  return value;\n}\nexport async function getLaunchParams() {\n  await bridge.send('VKWebAppGetLaunchParams').then(data => {\n    if (data.vk_app_id) {\n      launchParams = data;\n    }\n  }).catch(error => {\n    console.log(error);\n  });\n  return launchParams;\n}\n\nfunction getCustomParams() {\n  const hashString = window.location.hash.substring(1);\n  const pairs = hashString.split('&');\n  const params = {};\n  pairs.forEach(pair => {\n    const [key, value] = pair.split('=');\n    params[key] = decodeURIComponent(value);\n  });\n  return params;\n}\n\nexport async function createInviteURL(room_id) {\n  const baseAppUrl = \"https://vk.com/app\";\n  const vk_app_id = (await getLaunchParams()).vk_app_id;\n  const invitationUrl = `${baseAppUrl}${vk_app_id}#room_id=${room_id}`;\n  return invitationUrl;\n}\nexport async function copyToClipboard(text) {\n  bridge.send(\"VKWebAppCopyText\", {\n    text: text\n  }).then(data => {\n    if (data.result) {\n      console.log(\"successfully copied\");\n    }\n  }).catch(error => {\n    console.log(error);\n  });\n}\nexport async function initializeApp() {\n  await bridge.send(\"VKWebAppInit\");\n  var customParams = getCustomParams();\n\n  if (customParams.room_id) {\n    joinRoomOnStart = await joinRoom(customParams.room_id);\n  }\n}","map":{"version":3,"names":["bridge","AppId","joinRoom","joinRoomOnStart","undefined","Scopes","friends","photos","audio","video","stories","pages","menu","status","notes","messages","wall","ads","offline","docs","groups","notifications","stats","email","market","phone_number","getAccessToken","accessToken","scopes","Array","from","arguments","length","join","send","app_id","scope","then","data","access_token","catch","error","console","log","cachedStorage","launchParams","pushToStorage","key","value","result","clearTheStorage","keys","split","filter","x","forEach","getFromStorage","getLaunchParams","vk_app_id","getCustomParams","hashString","window","location","hash","substring","pairs","params","pair","decodeURIComponent","createInviteURL","room_id","baseAppUrl","invitationUrl","copyToClipboard","text","initializeApp","customParams"],"sources":["/Users/mirustal/Documents/project/rooms/front/rooms/src/bridge/bridgeLib.js"],"sourcesContent":["import bridge from \"@vkontakte/vk-bridge\";\nimport { AppId } from \"../config\";\nimport { joinRoom } from \"../serverApi/serverApi\";\n\nexport var joinRoomOnStart = undefined\nconst Scopes = {\n    friends: \"friends\",\n    photos: \"photos\",\n    audio: \"audio\",\n    video: \"video\",\n    stories: \"stories\",\n    pages: \"pages\",\n    menu: \"menu\",\n    status: \"status\",\n    notes: \"notes\",\n    messages: \"messages\",\n    wall: \"wall\",\n    ads: \"ads\",\n    offline: \"offline\",\n    docs: \"docs\",\n    groups: \"groups\",\n    notifications: \"notifications\",\n    stats: \"stats\",\n    email: \"email\",\n    market: \"market\",\n    phone_number: \"phone_number\"\n}\n\nasync function getAccessToken() {\n    let accessToken = undefined\n    let scopes = Array.from(arguments)\n    if (scopes.length > 0) scopes = scopes.join(\",\")\n    else scopes = ''\n\n    await bridge.send('VKWebAppGetAuthToken',\n        {\n            app_id: AppId,\n            scope: scopes\n        })\n        .then(data => {\n            if (data.access_token) accessToken = data.access_token\n        })\n        .catch(error => {\n            console.log(error)\n        })\n    return accessToken\n}\n\nvar cachedStorage = {}\nvar launchParams = undefined\n\nexport function pushToStorage(key, value) {\n    cachedStorage[key] = value;\n    console.log(key)\n    bridge.send('VKWebAppStorageSet', {\n        key: key,\n        value: value\n    })\n        .then((data) => {\n            if (data.result) console.log(`pushed to storage '${key}' with value:\\n${value}`)\n            else console.error(`failed to push to storage '${key}' with value:\\n${value}`)\n        })\n        .catch((error) => {\n            console.log(error);\n        });\n}\n\n\n\nexport function clearTheStorage(keys) {\n    keys.split(\",\").filter(x => x !== '').forEach(key => {\n\n        bridge.send('VKWebAppStorageSet', {\n            key: key,\n        })\n            .then((data) => {\n                if (data.result) {\n                    console.log('you storage clear')\n                }\n            })\n            .catch((error) => {\n                console.log(error);\n            });\n\n    });\n}\n\nexport async function getFromStorage(key) {\n    if (key in cachedStorage) {\n        return cachedStorage[key]\n    }\n    let value = undefined;\n    await bridge.send('VKWebAppStorageGet', {\n        keys: [key]\n    })\n        .then((data) => {\n            if (data.keys) {\n                value = data.keys[0].value;\n            }\n        })\n        .catch((error) => {\n            console.log(error);\n        });\n    return value;\n}\n\nexport async function getLaunchParams() {\n    await bridge.send('VKWebAppGetLaunchParams')\n        .then((data) => {\n            if (data.vk_app_id) {\n                launchParams = data\n            }\n        })\n        .catch((error) => {\n            console.log(error);\n        });\n    return launchParams;\n}\n\nfunction getCustomParams() {\n    const hashString = window.location.hash.substring(1);\n\n    const pairs = hashString.split('&');\n\n    const params = {};\n\n    pairs.forEach(pair => {\n        const [key, value] = pair.split('=');\n        params[key] = decodeURIComponent(value);\n    });\n\n    return params;\n}\n\nexport async function createInviteURL(room_id) {\n    const baseAppUrl = \"https://vk.com/app\";\n    const vk_app_id = (await getLaunchParams()).vk_app_id\n    const invitationUrl = `${baseAppUrl}${vk_app_id}#room_id=${room_id}`;\n    return invitationUrl;\n}\n\n\nexport async function copyToClipboard(text) {\n    bridge\n        .send(\"VKWebAppCopyText\", {\n            text: text,\n        })\n        .then((data) => {\n            if (data.result) {\n                console.log(\"successfully copied\");\n            }\n        })\n        .catch((error) => {\n            console.log(error);\n        });\n}\n\n\n\nexport async function initializeApp() {\n    await bridge.send(\"VKWebAppInit\");\n\n    var customParams = getCustomParams()\n\n    if (customParams.room_id) {\n        joinRoomOnStart = await joinRoom(customParams.room_id)\n    }\n\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}