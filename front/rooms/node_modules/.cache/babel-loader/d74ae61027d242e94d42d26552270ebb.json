{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { classNames } from \"@vkontakte/vkjs\";\nimport { useEventListener } from \"../../hooks/useEventListener\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { usePatchChildrenRef } from \"../../hooks/usePatchChildrenRef\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useDOM } from \"../../lib/dom\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { Popper } from \"../Popper/Popper\";\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\nexport var Popover = function (_param) {\n  var _param_action = _param.action,\n    action = _param_action === void 0 ? \"click\" : _param_action,\n    shownProp = _param.shown,\n    _param_showDelay = _param.showDelay,\n    showDelay = _param_showDelay === void 0 ? 150 : _param_showDelay,\n    _param_hideDelay = _param.hideDelay,\n    hideDelay = _param_hideDelay === void 0 ? 150 : _param_hideDelay,\n    _param_offsetDistance = _param.offsetDistance,\n    offsetDistance = _param_offsetDistance === void 0 ? 8 : _param_offsetDistance,\n    content = _param.content,\n    children = _param.children,\n    styleProp = _param.style,\n    className = _param.className,\n    getRef = _param.getRef,\n    onShownChange = _param.onShownChange,\n    _param_restoreFocus = _param.restoreFocus,\n    restoreFocus = _param_restoreFocus === void 0 ? true : _param_restoreFocus,\n    restProps = _object_without_properties(_param, [\"action\", \"shown\", \"showDelay\", \"hideDelay\", \"offsetDistance\", \"content\", \"children\", \"style\", \"className\", \"getRef\", \"onShownChange\", \"restoreFocus\"]);\n  var document = useDOM().document;\n  var hoverable = action === \"hover\";\n  var hovered = React.useRef(false);\n  var _React_useState = _sliced_to_array(React.useState(shownProp || false), 2),\n    computedShown = _React_useState[0],\n    setComputedShown = _React_useState[1];\n  var _React_useState1 = _sliced_to_array(React.useState(null), 2),\n    dropdownNode = _React_useState1[0],\n    setPopperNode = _React_useState1[1];\n  var shown = typeof shownProp === \"boolean\" ? shownProp : computedShown;\n  var patchedPopperRef = useExternRef(setPopperNode, getRef);\n  var _usePatchChildrenRef = _sliced_to_array(usePatchChildrenRef(children), 2),\n    childRef = _usePatchChildrenRef[0],\n    child = _usePatchChildrenRef[1];\n  var setShown = function (value) {\n    if (typeof shownProp !== \"boolean\") {\n      setComputedShown(value);\n    }\n    typeof onShownChange === \"function\" && onShownChange(value);\n  };\n  var showTimeout = useTimeout(function () {\n    return setShown(true);\n  }, showDelay);\n  var hideTimeout = useTimeout(function () {\n    return setShown(false);\n  }, hideDelay);\n  var handleTargetEnter = function () {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n  var handleTargetClick = function () {\n    if (hovered.current && shown) {\n      return;\n    }\n    setShown(!shown);\n  };\n  var handleTargetLeave = function () {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n  var handleContentKeyDownEscape = function () {\n    setShown(false);\n  };\n  var handleOutsideClick = function (e) {\n    var _childRef_current;\n    if (dropdownNode && !((_childRef_current = childRef.current) === null || _childRef_current === void 0 ? void 0 : _childRef_current.contains(e.target)) && !dropdownNode.contains(e.target)) {\n      setShown(false);\n    }\n  };\n  useGlobalEventListener(document, \"click\", handleOutsideClick, {\n    capture: true,\n    passive: true\n  });\n  var targetEnterListener = useEventListener(\"mouseenter\", handleTargetEnter);\n  var targetClickEvent = useEventListener(\"click\", handleTargetClick);\n  var targetLeaveListener = useEventListener(\"mouseleave\", handleTargetLeave);\n  React.useEffect(function () {\n    if (!childRef.current) {\n      return;\n    }\n    targetClickEvent.add(childRef.current);\n  }, [childRef, targetClickEvent]);\n  React.useEffect(function () {\n    if (!childRef.current) {\n      return;\n    }\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n    return function () {\n      targetEnterListener.remove();\n      targetLeaveListener.remove();\n    };\n  }, [childRef, hoverable, targetEnterListener, targetLeaveListener]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, child, shown && /*#__PURE__*/React.createElement(Popper, _object_spread_props(_object_spread({}, restProps), {\n    className: classNames(\"vkuiPopover\", className),\n    targetRef: childRef,\n    getRef: patchedPopperRef,\n    offsetDistance: offsetDistance,\n    style:\n    // Reason: Typescript ругается на CSS Custom Properties в объекте\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    _object_spread_props(_object_spread({}, styleProp), {\n      \"--vkui_internal--popover_safe_zone_padding\": \"\".concat(offsetDistance, \"px\")\n    }),\n    renderContent: function (param) {\n      var wrapperClassName = param.className;\n      return /*#__PURE__*/React.createElement(FocusTrap, {\n        className: classNames(\"vkuiPopover__in\", wrapperClassName),\n        onClose: handleContentKeyDownEscape,\n        restoreFocus: restoreFocus\n      }, content);\n    },\n    onMouseOver: hoverable ? hideTimeout.clear : undefined,\n    onMouseOut: hoverable ? handleTargetLeave : undefined\n  })));\n};","map":{"version":3,"names":["React","classNames","useEventListener","useExternRef","useGlobalEventListener","usePatchChildrenRef","useTimeout","useDOM","FocusTrap","Popper","Popover","_param","action","_param_action","shownProp","shown","_param_showDelay","showDelay","_param_hideDelay","hideDelay","_param_offsetDistance","offsetDistance","content","children","styleProp","style","className","getRef","onShownChange","_param_restoreFocus","restoreFocus","restProps","_object_without_properties","document","hoverable","hovered","useRef","_React_useState","_sliced_to_array","useState","computedShown","setComputedShown","_React_useState1","dropdownNode","setPopperNode","patchedPopperRef","_usePatchChildrenRef","childRef","child","setShown","value","showTimeout","hideTimeout","handleTargetEnter","current","clear","set","handleTargetClick","handleTargetLeave","handleContentKeyDownEscape","handleOutsideClick","e","_childRef_current","contains","target","capture","passive","targetEnterListener","targetClickEvent","targetLeaveListener","useEffect","add","remove","createElement","Fragment","_object_spread_props","_object_spread","targetRef","concat","renderContent","param","wrapperClassName","onClose","onMouseOver","undefined","onMouseOut"],"sources":["../../../src/components/Popover/Popover.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useEventListener } from '../../hooks/useEventListener';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { usePatchChildrenRef } from '../../hooks/usePatchChildrenRef';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useDOM } from '../../lib/dom';\nimport { FocusTrap, FocusTrapProps } from '../FocusTrap/FocusTrap';\nimport { Popper, PopperCommonProps } from '../Popper/Popper';\nimport styles from './Popover.module.css';\n\nexport interface PopoverProps\n  extends Omit<\n      PopperCommonProps,\n      'arrow' | 'arrowClassName' | 'arrowHeight' | 'arrowPadding' | 'ArrowIcon' | 'content'\n    >,\n    Pick<FocusTrapProps, 'restoreFocus'> {\n  /**\n   * Механика вызова всплывающего окна.\n   *\n   * - `\"click\"` – показывается/скрывается только при нажатии.\n   * - `\"hover\"` – помимо нажатия, будет показываться/скрывается при наведении/отведении мыши.\n   *\n   * > ⚠️`\"hover\"` на тач-устройствах будет работать как `\"click\"`, с одним лишь нюансом, что не будет закрываться\n   * > при повторном нажатии на целевой элемент. Для закрытия необходимо нажать на область вне целевого элемента\n   * > и выпадающего окна.\n   */\n  action?: 'click' | 'hover';\n  /**\n   * Если передан, то всплывающее окно будет показано/скрыто в зависимости от значения свойства.\n   */\n  shown?: boolean;\n  /**\n   * Количество миллисекунд, после которых произойдёт показ всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  showDelay?: number;\n  /**\n   * Количество миллисекунд, после которых произойдёт скрытие всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  hideDelay?: number;\n  /**\n   * Содержимое всплывающего окна.\n   */\n  content?: React.ReactNode;\n  /**\n   * Целевой элемент. Всплывающее окно появится возле него.\n   *\n   * > ⚠️ Если это пользовательский компонент, то он должен предоставлять параметры либо `getRootRef`, либо `ref` для получения ссылки на DOM-узел.\n   */\n  children?: React.ReactElement;\n  /**\n   * Вызывается при каждом изменении видимости всплывающего окна.\n   */\n  onShownChange?(shown: boolean): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\nexport const Popover = ({\n  action = 'click',\n  shown: shownProp,\n  showDelay = 150,\n  hideDelay = 150,\n  offsetDistance = 8,\n  content,\n  children,\n  style: styleProp,\n  className,\n  getRef,\n  onShownChange,\n  restoreFocus = true,\n  ...restProps\n}: PopoverProps) => {\n  const { document } = useDOM();\n\n  const hoverable = action === 'hover';\n  const hovered = React.useRef(false);\n  const [computedShown, setComputedShown] = React.useState(shownProp || false);\n  const [dropdownNode, setPopperNode] = React.useState<HTMLElement | null>(null);\n\n  const shown = typeof shownProp === 'boolean' ? shownProp : computedShown;\n\n  const patchedPopperRef = useExternRef<HTMLDivElement>(setPopperNode, getRef);\n\n  const [childRef, child] = usePatchChildrenRef(children);\n\n  const setShown = (value: boolean) => {\n    if (typeof shownProp !== 'boolean') {\n      setComputedShown(value);\n    }\n    typeof onShownChange === 'function' && onShownChange(value);\n  };\n\n  const showTimeout = useTimeout(() => setShown(true), showDelay);\n\n  const hideTimeout = useTimeout(() => setShown(false), hideDelay);\n\n  const handleTargetEnter = () => {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n\n  const handleTargetClick = () => {\n    if (hovered.current && shown) {\n      return;\n    }\n    setShown(!shown);\n  };\n\n  const handleTargetLeave = () => {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n\n  const handleContentKeyDownEscape = () => {\n    setShown(false);\n  };\n\n  const handleOutsideClick = (e: MouseEvent) => {\n    if (\n      dropdownNode &&\n      !childRef.current?.contains(e.target as Node) &&\n      !dropdownNode.contains(e.target as Node)\n    ) {\n      setShown(false);\n    }\n  };\n\n  useGlobalEventListener(document, 'click', handleOutsideClick, {\n    capture: true,\n    passive: true,\n  });\n  const targetEnterListener = useEventListener('mouseenter', handleTargetEnter);\n  const targetClickEvent = useEventListener('click', handleTargetClick);\n  const targetLeaveListener = useEventListener('mouseleave', handleTargetLeave);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    targetClickEvent.add(childRef.current);\n  }, [childRef, targetClickEvent]);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n\n    return () => {\n      targetEnterListener.remove();\n      targetLeaveListener.remove();\n    };\n  }, [childRef, hoverable, targetEnterListener, targetLeaveListener]);\n\n  return (\n    <React.Fragment>\n      {child}\n      {shown && (\n        <Popper\n          {...restProps}\n          className={classNames(styles['Popover'], className)}\n          targetRef={childRef}\n          getRef={patchedPopperRef}\n          offsetDistance={offsetDistance}\n          style={\n            // Reason: Typescript ругается на CSS Custom Properties в объекте\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            {\n              ...styleProp,\n              '--vkui_internal--popover_safe_zone_padding': `${offsetDistance}px`,\n            } as React.CSSProperties\n          }\n          renderContent={({ className: wrapperClassName }) => (\n            <FocusTrap\n              className={classNames(styles['Popover__in'], wrapperClassName)}\n              onClose={handleContentKeyDownEscape}\n              restoreFocus={restoreFocus}\n            >\n              {content}\n            </FocusTrap>\n          )}\n          onMouseOver={hoverable ? hideTimeout.clear : undefined}\n          onMouseOut={hoverable ? handleTargetLeave : undefined}\n        />\n      )}\n    </React.Fragment>\n  );\n};\n"],"mappings":";;;;AAAA,YAAYA,KAAA,MAAW;AACvB,SAASC,UAAU,QAAQ;AAC3B,SAASC,gBAAgB,QAAQ;AACjC,SAASC,YAAY,QAAQ;AAC7B,SAASC,sBAAsB,QAAQ;AACvC,SAASC,mBAAmB,QAAQ;AACpC,SAASC,UAAU,QAAQ;AAC3B,SAASC,MAAM,QAAQ;AACvB,SAASC,SAAS,QAAwB;AAC1C,SAASC,MAAM,QAA2B;AAoD1C;;;AAGA,OAAO,IAAMC,OAAA,GAAU,SAAAA,CAAAC,MAAA;6BACrBC,MAAA;IAAAA,MAAA,GAAAC,aAAA,cAAS,UAAAA,aAAA;IACTC,SAAO,GAAAH,MAAA,CAAPI,KAAA;IAAAC,gBAAA,GAAAL,MAAA,CACAM,SAAA;IAAAA,SAAA,GAAAD,gBAAA,cAAY,MAAAA,gBAAA;IAAAE,gBAAA,GAAAP,MAAA,CACZQ,SAAA;IAAAA,SAAA,GAAAD,gBAAA,cAAY,MAAAA,gBAAA;IAAAE,qBAAA,GAAAT,MAAA,CACZU,cAAA;IAAAA,cAAA,GAAAD,qBAAA,cAAiB,IAAAA,qBAAA;IACjBE,OAAA,GAAAX,MAAA,CAAAW,OAAA;IACAC,QAAA,GAAAZ,MAAA,CAAAY,QAAA;IACAC,SAAO,GAAAb,MAAA,CAAPc,KAAA;IACAC,SAAA,GAAAf,MAAA,CAAAe,SAAA;IACAC,MAAA,GAAAhB,MAAA,CAAAgB,MAAA;IACAC,aAAA,GAAAjB,MAAA,CAAAiB,aAAA;IAAAC,mBAAA,GAAAlB,MAAA,CACAmB,YAAA;IAAAA,YAAA,GAAAD,mBAAA,cAAe,OAAAA,mBAAA;IACZE,SAAA,GAAAC,0BAAA,CAAArB,MAAA,GAZH,UACA,SACA,aACA,aACA,kBACA,WACA,YACA,SACA,aACA,UACA,iBACA,e;EAGA,IAAMsB,QAAE,GAAa1B,MAAA,GAAb0B,QAAA;EAER,IAAMC,SAAA,GAAYtB,MAAA,KAAW;EAC7B,IAAMuB,OAAA,GAAUnC,KAAA,CAAMoC,MAAM,CAAC;EAC7B,IAA0CC,eAAA,GAAAC,gBAAA,CAAAtC,KAAA,CAAMuC,QAAQ,CAACzB,SAAA,IAAa;IAA/D0B,aAAA,GAAmCH,eAAA;IAApBI,gBAAA,GAAoBJ,eAAA;EAC1C,IAAsCK,gBAAA,GAAAJ,gBAAA,CAAAtC,KAAA,CAAMuC,QAAQ,CAAqB;IAAlEI,YAAA,GAA+BD,gBAAA;IAAjBE,aAAA,GAAiBF,gBAAA;EAEtC,IAAM3B,KAAA,GAAQ,OAAOD,SAAA,KAAc,YAAYA,SAAA,GAAY0B,aAAA;EAE3D,IAAMK,gBAAA,GAAmB1C,YAAA,CAA6ByC,aAAA,EAAejB,MAAA;EAErE,IAA0BmB,oBAAA,GAAAR,gBAAA,CAAAjC,mBAAA,CAAoBkB,QAAA;IAAvCwB,QAAA,GAAmBD,oBAAA;IAATE,KAAA,GAASF,oBAAA;EAE1B,IAAMG,QAAA,GAAW,SAAAA,CAACC,KAAA;IAChB,IAAI,OAAOpC,SAAA,KAAc,WAAW;MAClC2B,gBAAA,CAAiBS,KAAA;IACnB;IACA,OAAOtB,aAAA,KAAkB,cAAcA,aAAA,CAAcsB,KAAA;EACvD;EAEA,IAAMC,WAAA,GAAc7C,UAAA,CAAW;WAAM2C,QAAA,CAAS;KAAOhC,SAAA;EAErD,IAAMmC,WAAA,GAAc9C,UAAA,CAAW;WAAM2C,QAAA,CAAS;KAAQ9B,SAAA;EAEtD,IAAMkC,iBAAA,GAAoB,SAAAA,CAAA;IACxBlB,OAAA,CAAQmB,OAAO,GAAG;IAClBF,WAAA,CAAYG,KAAK;IACjBJ,WAAA,CAAYK,GAAG;EACjB;EAEA,IAAMC,iBAAA,GAAoB,SAAAA,CAAA;IACxB,IAAItB,OAAA,CAAQmB,OAAO,IAAIvC,KAAA,EAAO;MAC5B;IACF;IACAkC,QAAA,CAAS,CAAClC,KAAA;EACZ;EAEA,IAAM2C,iBAAA,GAAoB,SAAAA,CAAA;IACxBvB,OAAA,CAAQmB,OAAO,GAAG;IAClBH,WAAA,CAAYI,KAAK;IACjBH,WAAA,CAAYI,GAAG;EACjB;EAEA,IAAMG,0BAAA,GAA6B,SAAAA,CAAA;IACjCV,QAAA,CAAS;EACX;EAEA,IAAMW,kBAAA,GAAqB,SAAAA,CAACC,CAAA;QAGvBC,iBAAA;IAFH,IACEnB,YAAA,IACA,GAACmB,iBAAA,GAAAf,QAAA,CAASO,OAAO,cAAhBQ,iBAAA,uBAAAA,iBAAA,CAAkBC,QAAQ,CAACF,CAAA,CAAEG,MAAM,MACpC,CAACrB,YAAA,CAAaoB,QAAQ,CAACF,CAAA,CAAEG,MAAM,GAC/B;MACAf,QAAA,CAAS;IACX;EACF;EAEA7C,sBAAA,CAAuB6B,QAAA,EAAU,SAAS2B,kBAAA,EAAoB;IAC5DK,OAAA,EAAS;IACTC,OAAA,EAAS;EACX;EACA,IAAMC,mBAAA,GAAsBjE,gBAAA,CAAiB,cAAcmD,iBAAA;EAC3D,IAAMe,gBAAA,GAAmBlE,gBAAA,CAAiB,SAASuD,iBAAA;EACnD,IAAMY,mBAAA,GAAsBnE,gBAAA,CAAiB,cAAcwD,iBAAA;EAE3D1D,KAAA,CAAMsE,SAAS,CAAC;IACd,IAAI,CAACvB,QAAA,CAASO,OAAO,EAAE;MACrB;IACF;IAEAc,gBAAA,CAAiBG,GAAG,CAACxB,QAAA,CAASO,OAAO;EACvC,GAAG,CAACP,QAAA,EAAUqB,gBAAA,CAAiB;EAE/BpE,KAAA,CAAMsE,SAAS,CAAC;IACd,IAAI,CAACvB,QAAA,CAASO,OAAO,EAAE;MACrB;IACF;IAEA,IAAIpB,SAAA,EAAW;MACbiC,mBAAA,CAAoBI,GAAG,CAACxB,QAAA,CAASO,OAAO;MACxCe,mBAAA,CAAoBE,GAAG,CAACxB,QAAA,CAASO,OAAO;IAC1C;IAEA,OAAO;MACLa,mBAAA,CAAoBK,MAAM;MAC1BH,mBAAA,CAAoBG,MAAM;IAC5B;EACF,GAAG,CAACzB,QAAA,EAAUb,SAAA,EAAWiC,mBAAA,EAAqBE,mBAAA,CAAoB;EAElE,oBACErE,KAAA,CAAAyE,aAAA,CAACzE,KAAA,CAAM0E,QAAQ,QACZ1B,KAAA,EACAjC,KAAA,iBACCf,KAAA,CAAAyE,aAAA,CAAChE,MAAA,EAAAkE,oBAAA,CAAAC,cAAA,KACK7C,SAAA;IACJL,SAAA,EAAWzB,UAAA,gBAA8ByB,SAAA;IACzCmD,SAAA,EAAW9B,QAAA;IACXpB,MAAA,EAAQkB,gBAAA;IACRxB,cAAA,EAAgBA,cAAA;IAChBI,KAAA;IACE;IACA;IACAkD,oBAAA,CAAAC,cAAA,KACKpD,SAAA;MACH,8CAA8C,EAAC,CAAiBsD,MAAA,CAAfzD,cAAA,EAAe;;IAGpE0D,aAAA,EAAe,SAAAA,CAAAC,KAAA;UAAGC,gBAAW,GAAAD,KAAA,CAAXtD,SAAA;0BAChB1B,KAAA,CAAAyE,aAAA,CAACjE,SAAA;QACCkB,SAAA,EAAWzB,UAAA,oBAAkCgF,gBAAA;QAC7CC,OAAA,EAASvB,0BAAA;QACT7B,YAAA,EAAcA;SAEbR,OAAA;;IAGL6D,WAAA,EAAajD,SAAA,GAAYkB,WAAA,CAAYG,KAAK,GAAG6B,SAAA;IAC7CC,UAAA,EAAYnD,SAAA,GAAYwB,iBAAA,GAAoB0B;;AAKtD"},"metadata":{},"sourceType":"module"}