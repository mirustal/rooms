{"ast":null,"code":"import bridge from \"@vkontakte/vk-bridge\";\nimport { AppId } from \"../config\";\nimport { joinRoom } from \"../serverApi/serverApi\";\nexport var joinRoomOnStart = undefined;\nconst Scopes = {\n  friends: \"friends\",\n  photos: \"photos\",\n  audio: \"audio\",\n  video: \"video\",\n  stories: \"stories\",\n  pages: \"pages\",\n  menu: \"menu\",\n  status: \"status\",\n  notes: \"notes\",\n  messages: \"messages\",\n  wall: \"wall\",\n  ads: \"ads\",\n  offline: \"offline\",\n  docs: \"docs\",\n  groups: \"groups\",\n  notifications: \"notifications\",\n  stats: \"stats\",\n  email: \"email\",\n  market: \"market\",\n  phone_number: \"phone_number\"\n};\nasync function getAccessToken() {\n  let accessToken = undefined;\n  let scopes = Array.from(arguments);\n  if (scopes.length > 0) scopes = scopes.join(\",\");else scopes = '';\n  await bridge.send('VKWebAppGetAuthToken', {\n    app_id: AppId,\n    scope: scopes\n  }).then(data => {\n    if (data.access_token) accessToken = data.access_token;\n  }).catch(error => {\n    console.log(error);\n  });\n  return accessToken;\n}\nvar cachedStorage = {};\nvar launchParams = undefined;\nexport function pushToStorage(key, value) {\n  cachedStorage[key] = value;\n  bridge.send('VKWebAppStorageSet', {\n    key: key,\n    value: value\n  }).then(data => {\n    if (data.result) console.log(`pushed to storage '${key}' with value:\\n${value}`);else console.error(`failed to push to storage '${key}' with value:\\n${value}`);\n  }).catch(error => {\n    console.log(error);\n  });\n}\nexport async function getFromStorage(key) {\n  if (key in cachedStorage) {\n    return cachedStorage[key];\n  }\n  let value = undefined;\n  await bridge.send('VKWebAppStorageGet', {\n    keys: [key]\n  }).then(data => {\n    if (data.keys) {\n      value = data.keys[0].value;\n    }\n  }).catch(error => {\n    console.log(error);\n  });\n  return value;\n}\nexport async function getLaunchParams() {\n  await bridge.send('VKWebAppGetLaunchParams').then(data => {\n    if (data.vk_app_id) {\n      launchParams = data;\n    }\n  }).catch(error => {\n    console.log(error);\n  });\n  return launchParams;\n}\nfunction getCustomParams() {\n  const hashString = window.location.hash.substring(1);\n  const pairs = hashString.split('&');\n  const params = {};\n  pairs.forEach(pair => {\n    const [key, value] = pair.split('=');\n    params[key] = decodeURIComponent(value);\n  });\n  return params;\n}\nexport async function createInviteURL(room_id) {\n  const baseAppUrl = \"https://vk.com/app\";\n  const vk_app_id = (await getLaunchParams()).vk_app_id;\n  const invitationUrl = `${baseAppUrl}${vk_app_id}#room_id=${room_id}`;\n  return invitationUrl;\n}\nexport async function copyToClipboard(text) {\n  bridge.send(\"VKWebAppCopyText\", {\n    text: text\n  }).then(data => {\n    if (data.result) {\n      console.log(\"successfully copied\");\n    }\n  }).catch(error => {\n    console.log(error);\n  });\n}\nexport async function initializeApp() {\n  await bridge.send(\"VKWebAppInit\");\n  var customParams = getCustomParams();\n  if (customParams.room_id) {\n    joinRoomOnStart = await joinRoom(customParams.room_id);\n  }\n}","map":{"version":3,"names":["bridge","AppId","joinRoom","joinRoomOnStart","undefined","Scopes","friends","photos","audio","video","stories","pages","menu","status","notes","messages","wall","ads","offline","docs","groups","notifications","stats","email","market","phone_number","getAccessToken","accessToken","scopes","Array","from","arguments","length","join","send","app_id","scope","then","data","access_token","catch","error","console","log","cachedStorage","launchParams","pushToStorage","key","value","result","getFromStorage","keys","getLaunchParams","vk_app_id","getCustomParams","hashString","window","location","hash","substring","pairs","split","params","forEach","pair","decodeURIComponent","createInviteURL","room_id","baseAppUrl","invitationUrl","copyToClipboard","text","initializeApp","customParams"],"sources":["/Users/mirustal/Documents/project/rooms/front/rooms/src/bridge/bridgeLib.js"],"sourcesContent":["import bridge from \"@vkontakte/vk-bridge\";\nimport { AppId } from \"../config\";\nimport { joinRoom } from \"../serverApi/serverApi\";\n\nexport var joinRoomOnStart = undefined\nconst Scopes = {\n    friends: \"friends\",\n    photos: \"photos\",\n    audio: \"audio\",\n    video: \"video\",\n    stories: \"stories\",\n    pages: \"pages\",\n    menu: \"menu\",\n    status: \"status\",\n    notes: \"notes\",\n    messages: \"messages\",\n    wall: \"wall\",\n    ads: \"ads\",\n    offline: \"offline\",\n    docs: \"docs\",\n    groups: \"groups\",\n    notifications: \"notifications\",\n    stats: \"stats\",\n    email: \"email\",\n    market: \"market\",\n    phone_number: \"phone_number\"\n}\n\nasync function getAccessToken() {\n    let accessToken = undefined\n    let scopes = Array.from(arguments)\n    if (scopes.length > 0) scopes = scopes.join(\",\")\n    else scopes = ''\n\n    await bridge.send('VKWebAppGetAuthToken',\n    {\n        app_id: AppId,\n        scope: scopes\n    })\n    .then(data => {\n        if (data.access_token) accessToken = data.access_token\n    })\n    .catch(error => {\n        console.log(error)\n    })\n    return accessToken\n}\n\nvar cachedStorage = {}\nvar launchParams = undefined\n\nexport function pushToStorage(key, value) {\n    cachedStorage[key] = value;\n    bridge.send('VKWebAppStorageSet', {\n            key: key,\n            value: value\n       })\n       .then((data) => { \n            if (data.result) console.log(`pushed to storage '${key}' with value:\\n${value}`)\n            else  console.error(`failed to push to storage '${key}' with value:\\n${value}`)\n       })\n       .catch((error) => {\n            console.log(error);\n       });\n}\n\n\n\n\nexport async function getFromStorage(key) {\n    if (key in cachedStorage) {\n        return cachedStorage[key]\n    }\n    let value = undefined;\n    await bridge.send('VKWebAppStorageGet', { \n            keys: [ key ]\n        })\n        .then((data) => { \n            if (data.keys) {\n                value = data.keys[0].value;\n            }\n        })\n        .catch((error) => {\n            console.log(error);\n        });\n    return value;\n}\n\nexport async function getLaunchParams() {\n    await bridge.send('VKWebAppGetLaunchParams')\n    .then((data) => { \n        if (data.vk_app_id) {\n            launchParams = data\n        }\n    })\n    .catch((error) => {\n        console.log(error);\n    });\n    return launchParams;\n}\n \nfunction getCustomParams() {\n    const hashString = window.location.hash.substring(1);\n\n    const pairs = hashString.split('&');\n\n    const params = {};\n\n    pairs.forEach(pair => {\n        const [key, value] = pair.split('=');\n        params[key] = decodeURIComponent(value);\n    });\n\n    return params;\n}\n\nexport async function createInviteURL(room_id) {\n    const baseAppUrl = \"https://vk.com/app\"; \n    const vk_app_id = (await getLaunchParams()).vk_app_id\n    const invitationUrl = `${baseAppUrl}${vk_app_id}#room_id=${room_id}`;\n    return invitationUrl;\n  }\n\n\nexport async function copyToClipboard(text) {\n    bridge\n    .send(\"VKWebAppCopyText\", {\n      text: text,\n    })\n    .then((data) => {\n      if (data.result) {\n        console.log(\"successfully copied\");\n      }\n    })\n    .catch((error) => {\n      console.log(error);\n    });\n}\n  \n\n\nexport async function initializeApp() {\n    await bridge.send(\"VKWebAppInit\");\n\n    var customParams = getCustomParams()\n\n    if (customParams.room_id) {\n        joinRoomOnStart = await joinRoom(customParams.room_id)\n    }   \n\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}