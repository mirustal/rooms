{"ast":null,"code":"var _jsxFileName = \"/Users/mirustal/Documents/project/rooms/front/rooms/src/components/views/Channels/Channels.jsx\",\n    _s = $RefreshSig$();\n\nimport { View, Panel, Group, PanelHeader, PanelHeaderBack, CellButton, PanelHeaderContent, PullToRefresh, ScreenSpinner, Div } from \"@vkontakte/vkui\";\nimport { ModalIds, Views } from \"../../../model/views\";\nimport ChannelView from \"./ChannelView\";\nimport { Icon16MoreVertical, Icon24Add, Icon24LinkCircle } from \"@vkontakte/icons\";\nimport AlterActionSheet from \"./AlterActionSheet\";\nimport { editChannel } from \"../../../serverApi/serverApi\";\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { ModalManager } from \"../../Modals\";\nimport { Locales } from \"../../../locales/locales\";\nimport { getVkUserId } from \"../../../bridge/bridgeLib\";\nimport { AlertManagerContext, ErrorAlert } from \"../../contexts/AlertProvider\";\nimport { channelOperation } from \"./utils/channelOperation\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Channels(_ref) {\n  _s();\n\n  let {\n    returnBack,\n    roomMng,\n    redrawRoom\n  } = _ref;\n  const [editModeActive, setEditModeActive] = useState(false);\n  const [userIsAdmin, setIsAdmin] = useState(false);\n  const alerts = useContext(AlertManagerContext);\n  const channels = channelOperation(roomInfo, updateRoom, redrawRoom, alerts);\n  useEffect(() => {\n    isAdminInRoom(roomInfo).then(x => setIsAdmin(x));\n  }, []);\n\n  const handleActiveEditMode = () => {\n    setEditModeActive(!editModeActive);\n  };\n\n  async function isAdminInRoom(room) {\n    let user_id = await getVkUserId();\n\n    if (room) {\n      let findMember = room.members.find(member => member.id === user_id);\n      return findMember && findMember.role === \"admin\";\n    }\n  }\n\n  const handleCreateChannel = () => {\n    console.log(typeof channels.create); // Снова проверяем, что это 'function'\n\n    ModalManager.showModal(ModalIds.CreateChannel, {\n      createChannel: channels.create\n    });\n    console.log(roomInfo);\n  };\n\n  return roomInfo == null ? /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false) : /*#__PURE__*/_jsxDEV(View, {\n    id: Views.Rooms.id,\n    activePanel: Views.Rooms.panels.list.id,\n    children: /*#__PURE__*/_jsxDEV(Panel, {\n      id: Views.Rooms.panels.list.id,\n      children: [/*#__PURE__*/_jsxDEV(PanelHeader, {\n        before: /*#__PURE__*/_jsxDEV(PanelHeaderBack, {\n          onClick: returnBack\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 30\n        }, this),\n        children: /*#__PURE__*/_jsxDEV(Div, {\n          style: {\n            display: 'flex'\n          },\n          children: /*#__PURE__*/_jsxDEV(AlterActionSheet, {\n            roomInfo: roomInfo,\n            returnBack: returnBack,\n            handleActiveEditMode: handleActiveEditMode,\n            userIsAdmin: userIsAdmin\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Group, {\n        children: [roomInfo.channels && roomInfo.channels.length > 0 && roomInfo.channels.map((channel, index) => /*#__PURE__*/_jsxDEV(ChannelView, {\n          channelIndex: index,\n          channel: channel,\n          renameToChannel: () => {\n            ModalManager.showModal(ModalIds.RenameChannel, {\n              renameChannelId: channel.id,\n              renameChannel: channels.rename\n            });\n          },\n          deleteToChannel: id => {\n            channels.delete(id);\n          },\n          editModeActive: editModeActive,\n          refreshChannel: id => channels.refresh(id),\n          userIsAdmin: userIsAdmin\n        }, channel.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 15\n        }, this)), userIsAdmin && /*#__PURE__*/_jsxDEV(CellButton, {\n          onClick: handleCreateChannel,\n          centered: true,\n          before: /*#__PURE__*/_jsxDEV(Icon24Add, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 21\n          }, this),\n          children: \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043A\\u0430\\u043D\\u0430\\u043B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Channels, \"xCPk9YX/CiQzJkh64HA4wXODmaU=\");\n\n_c = Channels;\n\nvar _c;\n\n$RefreshReg$(_c, \"Channels\");","map":{"version":3,"names":["View","Panel","Group","PanelHeader","PanelHeaderBack","CellButton","PanelHeaderContent","PullToRefresh","ScreenSpinner","Div","ModalIds","Views","ChannelView","Icon16MoreVertical","Icon24Add","Icon24LinkCircle","AlterActionSheet","editChannel","React","useContext","useEffect","useState","ModalManager","Locales","getVkUserId","AlertManagerContext","ErrorAlert","channelOperation","Channels","returnBack","roomMng","redrawRoom","editModeActive","setEditModeActive","userIsAdmin","setIsAdmin","alerts","channels","roomInfo","updateRoom","isAdminInRoom","then","x","handleActiveEditMode","room","user_id","findMember","members","find","member","id","role","handleCreateChannel","console","log","create","showModal","CreateChannel","createChannel","Rooms","panels","list","display","length","map","channel","index","RenameChannel","renameChannelId","renameChannel","rename","delete","refresh"],"sources":["/Users/mirustal/Documents/project/rooms/front/rooms/src/components/views/Channels/Channels.jsx"],"sourcesContent":["import {\n  View,\n  Panel,\n  Group,\n  PanelHeader,\n  PanelHeaderBack,\n  CellButton,\n  PanelHeaderContent,\n  PullToRefresh,\n  ScreenSpinner,\n  Div,\n} from \"@vkontakte/vkui\";\nimport { ModalIds, Views } from \"../../../model/views\";\nimport ChannelView from \"./ChannelView\";\nimport {\n  Icon16MoreVertical,\n  Icon24Add,\n  Icon24LinkCircle,\n} from \"@vkontakte/icons\";\nimport AlterActionSheet from \"./AlterActionSheet\";\nimport { editChannel } from \"../../../serverApi/serverApi\";\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { ModalManager } from \"../../Modals\";\nimport { Locales } from \"../../../locales/locales\";\nimport { getVkUserId } from \"../../../bridge/bridgeLib\";\nimport { AlertManagerContext, ErrorAlert } from \"../../contexts/AlertProvider\";\nimport { channelOperation } from \"./utils/channelOperation\";\n\nexport default function Channels({ returnBack, roomMng, redrawRoom }) {\n  \n  const [editModeActive, setEditModeActive] = useState(false);\n  const [userIsAdmin, setIsAdmin] = useState(false); \n\n  const alerts = useContext(AlertManagerContext)\n  const channels = channelOperation(roomInfo, updateRoom, redrawRoom, alerts)\n\n  useEffect(() => {\n    isAdminInRoom(roomInfo).then(x => setIsAdmin(x))\n  }, []);\n\n  const handleActiveEditMode = () => {\n    setEditModeActive(!editModeActive);\n  };\n\n  async function isAdminInRoom(room) {\n    let user_id = await getVkUserId(); \n    if (room) {\n      let findMember = room.members.find(member => member.id === user_id); \n      return findMember && findMember.role === \"admin\"; \n    }\n  }\n\n  const handleCreateChannel = () => {\n    console.log(typeof channels.create); // Снова проверяем, что это 'function'\n    ModalManager.showModal(ModalIds.CreateChannel, { \n      createChannel: channels.create\n    });\n    console.log(roomInfo)\n  };\n\n  return roomInfo == null ? (\n    <></>\n  ) : (\n    <View id={Views.Rooms.id} activePanel={Views.Rooms.panels.list.id}>\n      <Panel id={Views.Rooms.panels.list.id}>\n  \n        <PanelHeader before={<PanelHeaderBack onClick={returnBack}/>}>\n        <Div style={{display: 'flex'}}>  \n            <AlterActionSheet\n              roomInfo={roomInfo}\n              returnBack={returnBack}\n              handleActiveEditMode={handleActiveEditMode}\n              userIsAdmin={userIsAdmin} />\n          </Div>\n        </PanelHeader>\n        <Group>\n          {roomInfo.channels &&\n            roomInfo.channels.length > 0 &&\n            roomInfo.channels.map((channel, index) => (\n\n              <ChannelView\n                key={channel.id}\n                channelIndex={index}\n                channel={channel}\n                renameToChannel={() => {\n                  ModalManager.showModal(ModalIds.RenameChannel, {\n                    renameChannelId: channel.id,\n                    renameChannel: channels.rename,\n                  })\n                }}\n                deleteToChannel={(id) => {channels.delete(id)}}\n                editModeActive={editModeActive}\n                refreshChannel={(id) => channels.refresh(id)}\n                userIsAdmin={userIsAdmin}\n              />\n\n            ))}\n            {userIsAdmin && \n          <CellButton\n            onClick={handleCreateChannel\n            }\n            centered\n            before={<Icon24Add />}\n          >\n            Создать канал\n          </CellButton>\n            }\n        </Group>\n      </Panel>\n    </View>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}