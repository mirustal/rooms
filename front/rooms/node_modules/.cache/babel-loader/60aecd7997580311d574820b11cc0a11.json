{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { clamp } from \"../../helpers/math\";\nimport { useIsClient } from \"../../hooks/useIsClient\";\nimport { BaseGallery } from \"../BaseGallery/BaseGallery\";\nimport { CarouselBase } from \"../BaseGallery/CarouselBase/CarouselBase\";\nimport { useAutoPlay } from \"./hooks\";\n/**\n * @see https://vkcom.github.io/VKUI/#/Gallery\n */\nexport var Gallery = function (_param) {\n  var _param_initialSlideIndex = _param.initialSlideIndex,\n    initialSlideIndex = _param_initialSlideIndex === void 0 ? 0 : _param_initialSlideIndex,\n    children = _param.children,\n    _param_timeout = _param.timeout,\n    timeout = _param_timeout === void 0 ? 0 : _param_timeout,\n    onChange = _param.onChange,\n    bullets = _param.bullets,\n    looped = _param.looped,\n    props = _object_without_properties(_param, [\"initialSlideIndex\", \"children\", \"timeout\", \"onChange\", \"bullets\", \"looped\"]);\n  var _React_useState = _sliced_to_array(React.useState(initialSlideIndex), 2),\n    localSlideIndex = _React_useState[0],\n    setSlideIndex = _React_useState[1];\n  var isControlled = typeof props.slideIndex === \"number\";\n  var _props_slideIndex;\n  var slideIndex = isControlled ? (_props_slideIndex = props.slideIndex) !== null && _props_slideIndex !== void 0 ? _props_slideIndex : 0 : localSlideIndex;\n  var isDraggable = !isControlled || Boolean(onChange);\n  var slides = React.useMemo(function () {\n    return React.Children.toArray(children).filter(function (item) {\n      return Boolean(item);\n    });\n  }, [children]);\n  var childCount = slides.length;\n  var isClient = useIsClient();\n  var handleChange = React.useCallback(function (current) {\n    if (current === slideIndex) {\n      return;\n    }\n    !isControlled && setSlideIndex(current);\n    onChange && onChange(current);\n  }, [isControlled, onChange, slideIndex]);\n  useAutoPlay(timeout, slideIndex, function () {\n    return handleChange((slideIndex + 1) % childCount);\n  });\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  var safeSlideIndex = childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(function () {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n    setSlideIndex(safeSlideIndex);\n  }, [onChange, safeSlideIndex, slideIndex]);\n  if (!isClient) {\n    return null;\n  }\n  var Component = looped ? CarouselBase : BaseGallery;\n  return /*#__PURE__*/React.createElement(Component, _object_spread_props(_object_spread({\n    isDraggable: isDraggable\n  }, props), {\n    bullets: childCount > 0 && bullets,\n    slideIndex: safeSlideIndex,\n    onChange: handleChange\n  }), slides);\n};","map":{"version":3,"names":["React","clamp","useIsClient","BaseGallery","CarouselBase","useAutoPlay","Gallery","_param","initialSlideIndex","_param_initialSlideIndex","children","_param_timeout","timeout","onChange","bullets","looped","props","_object_without_properties","_React_useState","_sliced_to_array","useState","localSlideIndex","setSlideIndex","isControlled","slideIndex","_props_slideIndex","isDraggable","Boolean","slides","useMemo","Children","toArray","filter","item","childCount","length","isClient","handleChange","useCallback","current","safeSlideIndex","useEffect","Component","createElement","_object_spread_props","_object_spread"],"sources":["../../../src/components/Gallery/Gallery.tsx"],"sourcesContent":["import * as React from 'react';\nimport { clamp } from '../../helpers/math';\nimport { useIsClient } from '../../hooks/useIsClient';\nimport { BaseGallery } from '../BaseGallery/BaseGallery';\nimport { CarouselBase } from '../BaseGallery/CarouselBase/CarouselBase';\nimport { BaseGalleryProps } from '../BaseGallery/types';\nimport { useAutoPlay } from './hooks';\n\nexport interface GalleryProps extends BaseGalleryProps {\n  initialSlideIndex?: number;\n  timeout?: number;\n  // Отвечает за зацикливание слайдов\n  looped?: boolean;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Gallery\n */\nexport const Gallery = ({\n  initialSlideIndex = 0,\n  children,\n  timeout = 0,\n  onChange,\n  bullets,\n  looped,\n  ...props\n}: GalleryProps) => {\n  const [localSlideIndex, setSlideIndex] = React.useState(initialSlideIndex);\n  const isControlled = typeof props.slideIndex === 'number';\n  const slideIndex = isControlled ? props.slideIndex ?? 0 : localSlideIndex;\n  const isDraggable = !isControlled || Boolean(onChange);\n  const slides = React.useMemo(\n    () => React.Children.toArray(children).filter((item) => Boolean(item)),\n    [children],\n  );\n  const childCount = slides.length;\n  const isClient = useIsClient();\n\n  const handleChange: GalleryProps['onChange'] = React.useCallback(\n    (current: number) => {\n      if (current === slideIndex) {\n        return;\n      }\n      !isControlled && setSlideIndex(current);\n      onChange && onChange(current);\n    },\n    [isControlled, onChange, slideIndex],\n  );\n\n  useAutoPlay(timeout, slideIndex, () => handleChange((slideIndex + 1) % childCount));\n\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  const safeSlideIndex = childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(() => {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n    setSlideIndex(safeSlideIndex);\n  }, [onChange, safeSlideIndex, slideIndex]);\n\n  if (!isClient) {\n    return null;\n  }\n\n  const Component = looped ? CarouselBase : BaseGallery;\n\n  return (\n    <Component\n      isDraggable={isDraggable}\n      {...props}\n      bullets={childCount > 0 && bullets}\n      slideIndex={safeSlideIndex}\n      onChange={handleChange}\n    >\n      {slides}\n    </Component>\n  );\n};\n"],"mappings":";;;;AAAA,YAAYA,KAAA,MAAW;AACvB,SAASC,KAAK,QAAQ;AACtB,SAASC,WAAW,QAAQ;AAC5B,SAASC,WAAW,QAAQ;AAC5B,SAASC,YAAY,QAAQ;AAE7B,SAASC,WAAW,QAAQ;AAS5B;;;AAGA,OAAO,IAAMC,OAAA,GAAU,SAAAA,CAAAC,MAAA;wCACrBC,iBAAA;IAAAA,iBAAA,GAAAC,wBAAA,cAAoB,IAAAA,wBAAA;IACpBC,QAAA,GAAAH,MAAA,CAAAG,QAAA;IAAAC,cAAA,GAAAJ,MAAA,CACAK,OAAA;IAAAA,OAAA,GAAAD,cAAA,cAAU,IAAAA,cAAA;IACVE,QAAA,GAAAN,MAAA,CAAAM,QAAA;IACAC,OAAA,GAAAP,MAAA,CAAAO,OAAA;IACAC,MAAA,GAAAR,MAAA,CAAAQ,MAAA;IACGC,KAAA,GAAAC,0BAAA,CAAAV,MAAA,GANH,qBACA,YACA,WACA,YACA,WACA,S;EAGA,IAAyCW,eAAA,GAAAC,gBAAA,CAAAnB,KAAA,CAAMoB,QAAQ,CAACZ,iBAAA;IAAjDa,eAAA,GAAkCH,eAAA;IAAjBI,aAAA,GAAiBJ,eAAA;EACzC,IAAMK,YAAA,GAAe,OAAOP,KAAA,CAAMQ,UAAU,KAAK;MACfC,iBAAA;EAAlC,IAAMD,UAAA,GAAaD,YAAA,GAAe,CAAAE,iBAAA,GAAAT,KAAA,CAAMQ,UAAU,cAAhBC,iBAAA,cAAAA,iBAAA,GAAoB,IAAIJ,eAAA;EAC1D,IAAMK,WAAA,GAAc,CAACH,YAAA,IAAgBI,OAAA,CAAQd,QAAA;EAC7C,IAAMe,MAAA,GAAS5B,KAAA,CAAM6B,OAAO,CAC1B;WAAM7B,KAAA,CAAM8B,QAAQ,CAACC,OAAO,CAACrB,QAAA,EAAUsB,MAAM,CAAC,UAACC,IAAA;aAASN,OAAA,CAAQM,IAAA;;KAChE,CAACvB,QAAA,CAAS;EAEZ,IAAMwB,UAAA,GAAaN,MAAA,CAAOO,MAAM;EAChC,IAAMC,QAAA,GAAWlC,WAAA;EAEjB,IAAMmC,YAAA,GAAyCrC,KAAA,CAAMsC,WAAW,CAC9D,UAACC,OAAA;IACC,IAAIA,OAAA,KAAYf,UAAA,EAAY;MAC1B;IACF;IACA,CAACD,YAAA,IAAgBD,aAAA,CAAciB,OAAA;IAC/B1B,QAAA,IAAYA,QAAA,CAAS0B,OAAA;EACvB,GACA,CAAChB,YAAA,EAAcV,QAAA,EAAUW,UAAA,CAAW;EAGtCnB,WAAA,CAAYO,OAAA,EAASY,UAAA,EAAY;WAAMa,YAAA,CAAa,CAACb,UAAA,GAAa,KAAKU,UAAA;;EAEvE;EACA;EACA,IAAMM,cAAA,GAAiBN,UAAA,GAAa,IAAIjC,KAAA,CAAMuB,UAAA,EAAY,GAAGU,UAAA,GAAa,KAAKV,UAAA;EAC/E;EACAxB,KAAA,CAAMyC,SAAS,CAAC;IACd,IAAI5B,QAAA,IAAY2B,cAAA,KAAmBhB,UAAA,EAAY;MAC7CX,QAAA,CAAS2B,cAAA;IACX;IACAlB,aAAA,CAAckB,cAAA;EAChB,GAAG,CAAC3B,QAAA,EAAU2B,cAAA,EAAgBhB,UAAA,CAAW;EAEzC,IAAI,CAACY,QAAA,EAAU;IACb,OAAO;EACT;EAEA,IAAMM,SAAA,GAAY3B,MAAA,GAASX,YAAA,GAAeD,WAAA;EAE1C,oBACEH,KAAA,CAAA2C,aAAA,CAACD,SAAA,EAAAE,oBAAA,CAAAC,cAAA;IACCnB,WAAA,EAAaA;KACTV,KAAA;IACJF,OAAA,EAASoB,UAAA,GAAa,KAAKpB,OAAA;IAC3BU,UAAA,EAAYgB,cAAA;IACZ3B,QAAA,EAAUwB;MAETT,MAAA;AAGP"},"metadata":{},"sourceType":"module"}